(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,54338,75076,50136,e=>{"use strict";let t;var r=e.i(71645);e.i(51718);var a=e.i(18357),s=e.i(59141);e.i(36180);var l=e.i(98925);let n={toFirestore:e=>({...e,createdAt:l.Timestamp.fromDate(e.createdAt),updatedAt:l.Timestamp.fromDate(e.updatedAt),lastActiveAt:l.Timestamp.fromDate(e.lastActiveAt)}),fromFirestore:e=>{let t=e.data();return{...t,id:e.id,createdAt:t.createdAt.toDate(),updatedAt:t.updatedAt.toDate(),lastActiveAt:t.lastActiveAt.toDate()}}},o={toFirestore:e=>({...e,createdAt:l.Timestamp.fromDate(e.createdAt),updatedAt:l.Timestamp.fromDate(e.updatedAt),startedAt:e.startedAt?l.Timestamp.fromDate(e.startedAt):null,completedAt:e.completedAt?l.Timestamp.fromDate(e.completedAt):null,teeTime:l.Timestamp.fromDate(e.teeTime)}),fromFirestore:e=>{let t=e.data();return{...t,id:e.id,createdAt:t.createdAt.toDate(),updatedAt:t.updatedAt.toDate(),startedAt:t.startedAt?.toDate()??null,completedAt:t.completedAt?.toDate()??null,teeTime:t.teeTime.toDate()}}},i={toFirestore:e=>({...e,invitedAt:l.Timestamp.fromDate(e.invitedAt),confirmedAt:e.confirmedAt?l.Timestamp.fromDate(e.confirmedAt):null}),fromFirestore:e=>{let t=e.data();return{...t,id:e.id,invitedAt:t.invitedAt.toDate(),confirmedAt:t.confirmedAt?.toDate()??null}}},c={toFirestore:e=>({...e,createdAt:l.Timestamp.fromDate(e.createdAt),updatedAt:l.Timestamp.fromDate(e.updatedAt),syncedAt:e.syncedAt?l.Timestamp.fromDate(e.syncedAt):null}),fromFirestore:e=>{let t=e.data();return{...t,id:e.id,createdAt:t.createdAt.toDate(),updatedAt:t.updatedAt.toDate(),syncedAt:t.syncedAt?.toDate()??null}}},d={toFirestore:e=>({...e,createdAt:l.Timestamp.fromDate(e.createdAt)}),fromFirestore:e=>{let t=e.data();return{...t,id:e.id,createdAt:t.createdAt.toDate()}}};function u(){return t||(t=(0,l.getFirestore)()),t}let m=e=>(0,l.doc)((0,l.collection)(u(),"users"),e).withConverter(n);async function f(e){try{let t=await (0,l.getDoc)(m(e));return t.exists()?t.data():null}catch(e){throw console.error("Error fetching user:",e),e}}async function h(e,t){let r=new Date,a={id:e,displayName:t.displayName,email:t.email,avatarUrl:null,handicapIndex:null,homeClub:null,defaultTeeBox:"blue",notificationsEnabled:!0,createdAt:r,updatedAt:r,lastActiveAt:r};try{return await (0,l.setDoc)(m(e),a),a}catch(e){throw console.error("Error creating user:",e),e}}async function p(e,t){try{await (0,l.updateDoc)(m(e),{...t,updatedAt:new Date})}catch(e){throw console.error("Error updating user:",e),e}}async function x(e){try{await (0,l.updateDoc)(m(e),{lastActiveAt:new Date})}catch(e){throw console.error("Error updating user activity:",e),e}}function A(){let[e,t]=(0,r.useState)(null),[l,n]=(0,r.useState)(null),[o,i]=(0,r.useState)(!0),[c,d]=(0,r.useState)(null);return(0,r.useEffect)(()=>{let e=(0,a.onAuthStateChanged)(s.auth,async e=>{try{if(t(e),e){let t=await f(e.uid);if(t)await x(e.uid);else{let r=e.displayName||e.email||"User",a=e.email||"";t=await h(e.uid,{displayName:r,email:a})}n(t),d(null)}else n(null),d(null);i(!1)}catch(e){d(e instanceof Error?e:Error("Unknown auth error")),i(!1)}});return()=>e()},[]),{firebaseUser:e,user:l,loading:o,error:c}}e.s(["betDoc",0,(e,t)=>(0,l.doc)((0,l.collection)(u(),`matches/${e}/bets`),t).withConverter(d),"matchDoc",0,e=>(0,l.doc)((0,l.collection)(u(),"matches"),e).withConverter(o),"matchesCollection",0,()=>(0,l.collection)(u(),"matches").withConverter(o),"participantsCollection",0,e=>(0,l.collection)(u(),`matches/${e}/participants`).withConverter(i),"scoreDoc",0,(e,t)=>(0,l.doc)((0,l.collection)(u(),`matches/${e}/scores`),t).withConverter(c),"scoresCollection",0,e=>(0,l.collection)(u(),`matches/${e}/scores`).withConverter(c),"userDoc",0,m],75076),e.s(["createUser",()=>h,"getUser",()=>f,"updateUser",()=>p,"updateUserActivity",()=>x],50136),e.s(["useAuth",()=>A],54338)},64649,48010,e=>{"use strict";var t=e.i(43476),r=e.i(71645),a=e.i(18566),s=e.i(54338);e.i(84004);var l=e.i(66085);function n({children:e}){let{user:n,loading:o}=(0,s.useAuth)(),i=(0,a.useRouter)();return((0,r.useEffect)(()=>{o||n||i.push("/login")},[n,o,i]),o)?(0,t.jsx)(l.Screen,{className:"flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"animate-spin text-4xl mb-4",children:"â›³"}),(0,t.jsx)("p",{className:"text-gray-500",children:"Loading..."})]})}):n?(0,t.jsx)(t.Fragment,{children:e}):null}e.s(["ProtectedRoute",()=>n],48010),e.s([],64649)},87525,e=>{"use strict";var t=e.i(71645);e.i(36180);var r=e.i(98925);function a(e){let t=new Map;return e.forEach(e=>{t.has(e.fromUserId)||t.set(e.fromUserId,0),t.has(e.toUserId)||t.set(e.toUserId,0)}),e.forEach(e=>{let r=t.get(e.fromUserId)||0,a=t.get(e.toUserId)||0;t.set(e.fromUserId,r-e.amount),t.set(e.toUserId,a+e.amount)}),t}function s(e){return a(e.filter(e=>!e.settled))}function l(e){return Array.from(e.entries()).filter(([,e])=>e<0).map(([e,t])=>({userId:e,amount:Math.abs(t)})).sort((e,t)=>t.amount-e.amount)}function n(e){return Array.from(e.entries()).filter(([,e])=>e>0).map(([e,t])=>({userId:e,amount:t})).sort((e,t)=>t.amount-e.amount)}let o=(0,r.getFirestore)();function i(e){let[i,c]=(0,t.useState)([]),[d,u]=(0,t.useState)(!0),[m,f]=(0,t.useState)(null);(0,t.useEffect)(()=>{if(!e)return;let t=null,a=null;try{let s=(0,r.query)((0,r.collectionGroup)(o,"ledger"),(0,r.where)("fromUserId","==",e)),l=(0,r.query)((0,r.collectionGroup)(o,"ledger"),(0,r.where)("toUserId","==",e));return t=(0,r.onSnapshot)(s,t=>{let r=t.docs.map(e=>e.data());c(t=>{let a=t.filter(t=>t.toUserId===e);return[...r,...a]}),f(null),u(!1)},e=>{console.error("Error subscribing to ledger (from):",e),f(e instanceof Error?e:Error("Unknown error")),u(!1)}),a=(0,r.onSnapshot)(l,t=>{let r=t.docs.map(e=>e.data());c(t=>[...t.filter(t=>t.fromUserId===e),...r]),f(null),u(!1)},e=>{console.error("Error subscribing to ledger (to):",e),f(e instanceof Error?e:Error("Unknown error")),u(!1)}),()=>{t?.(),a?.()}}catch{}},[e]);let h=a(i),p=s(i),x=l(h),A=n(h);return{entries:i,balances:h,unsettledBalances:p,debtors:x,creditors:A,loading:d,error:m}}function c(e){let[i,c]=(0,t.useState)([]),[d,u]=(0,t.useState)(!0),[m,f]=(0,t.useState)(null);(0,t.useEffect)(()=>{if(e)try{let t=(0,r.onSnapshot)((0,r.query)((0,r.collectionGroup)(o,"ledger")),t=>{let r=t.docs.filter(t=>t.ref.parent.parent?.id===e).map(e=>e.data());c(r),f(null),u(!1)},e=>{console.error("Error subscribing to match ledger:",e),f(e instanceof Error?e:Error("Unknown error")),u(!1)});return()=>t()}catch{}},[e]);let h=a(i),p=s(i),x=l(h),A=n(h);return{entries:i,balances:h,unsettledBalances:p,debtors:x,creditors:A,loading:d,error:m}}e.s(["useLedger",()=>i,"useMatchLedger",()=>c],87525)},23913,e=>{"use strict";var t=e.i(43476),r=e.i(71645);e.i(84004);var a=e.i(66085),s=e.i(3374);e.i(16787);var l=e.i(39964),n=e.i(59544),o=e.i(91285);function i({name:e,amount:r,onSettle:a,isSettling:s=!1,className:n}){let i=r>0,c=Math.abs(r);return(0,t.jsxs)(l.Card,{variant:"outlined",className:(0,o.cn)("p-4",n),children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("h3",{className:"font-semibold text-gray-900",children:e}),(0,t.jsx)("p",{className:(0,o.cn)("text-sm mt-1 font-medium",i?"text-fairway-600":"text-red-600"),children:i?"âœ“ Owes you":"â€¢ You owe"})]}),(0,t.jsx)("div",{className:"text-right",children:(0,t.jsxs)("p",{className:(0,o.cn)("text-2xl font-bold",i?"text-fairway-600":"text-red-600"),children:["$",c.toFixed(2)]})})]}),a&&(0,t.jsx)("button",{onClick:a,disabled:s,className:(0,o.cn)("w-full mt-4 px-3 py-2 rounded-lg text-sm font-medium transition-colors",s?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-gray-100 hover:bg-gray-200 text-gray-900"),"aria-label":`Mark ${e} as settled`,children:s?"Marking...":"Mark Settled"})]})}function c({balances:e,loading:a=!1,className:s}){let[l,n]=(0,r.useState)(null),c=async(e,t)=>{if(t){n(e);try{await t(e)}catch(e){console.error("Error settling balance:",e)}finally{n(null)}}},d=[...e].sort((e,t)=>{let r=+(e.amount>0),a=+(t.amount>0);return r!==a?a-r:Math.abs(t.amount)-Math.abs(e.amount)});return 0===e.length?(0,t.jsxs)("div",{className:(0,o.cn)("text-center py-12",s),children:[(0,t.jsx)("p",{className:"text-3xl mb-2",children:"âœ…"}),(0,t.jsx)("p",{className:"text-gray-600 font-medium",children:"All settled up!"}),(0,t.jsx)("p",{className:"text-gray-500 text-sm mt-1",children:"No pending settlements"})]}):(0,t.jsxs)("div",{className:(0,o.cn)("space-y-3",s),children:[a&&(0,t.jsxs)("div",{className:"text-center py-8",children:[(0,t.jsx)("div",{className:"animate-spin text-4xl mb-2",children:"â›³"}),(0,t.jsx)("p",{className:"text-gray-500 text-sm",children:"Loading settlements..."})]}),!a&&d.map(e=>(0,t.jsx)(i,{name:e.name,amount:e.amount,onSettle:e.canSettle&&e.onSettle?()=>c(e.userId,e.onSettle):void 0,isSettling:l===e.userId},e.userId))]})}e.i(64649);var d=e.i(48010),u=e.i(54338),m=e.i(87525);function f(){let{firebaseUser:e}=(0,u.useAuth)(),o=e?.uid||null,{entries:i,balances:f,loading:h,error:p}=(0,m.useLedger)(o),[x,A]=(0,r.useState)(null),g=Array.from(f.entries()).map(([e,t])=>({userId:e,name:`Player ${e.slice(0,6)}`,amount:t,canSettle:!0,onSettle:async()=>{try{for(let t of(A(null),i.filter(t=>!t.settled&&(t.fromUserId===o&&t.toUserId===e||t.fromUserId===e&&t.toUserId===o))))console.log("Settling entry:",t.id)}catch(e){console.error("Error settling:",e),A(e instanceof Error?e.message:"Failed to settle")}}}));return(0,t.jsx)(d.ProtectedRoute,{children:(0,t.jsxs)(a.Screen,{padBottom:!0,children:[(0,t.jsx)(s.Header,{title:"Ledger",subtitle:"Your Balances"}),(0,t.jsxs)("div",{className:"p-4 pb-24 space-y-6",children:[(p||x)&&(0,t.jsx)(l.Card,{variant:"outlined",className:"bg-red-50 border-red-200 p-4",children:(0,t.jsx)("p",{className:"text-red-700 text-sm",children:p?.message||x})}),!h&&(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,t.jsxs)(l.Card,{variant:"elevated",className:"p-4",children:[(0,t.jsx)("p",{className:"text-gray-500 text-sm mb-1",children:"You're Owed"}),(0,t.jsxs)("p",{className:"text-2xl font-bold text-fairway-600",children:["$",Array.from(f.values()).filter(e=>e>0).reduce((e,t)=>e+t,0).toFixed(2)]})]}),(0,t.jsxs)(l.Card,{variant:"elevated",className:"p-4",children:[(0,t.jsx)("p",{className:"text-gray-500 text-sm mb-1",children:"You Owe"}),(0,t.jsxs)("p",{className:"text-2xl font-bold text-red-600",children:["$",Math.abs(Array.from(f.values()).filter(e=>e<0).reduce((e,t)=>e+t,0)).toFixed(2)]})]})]}),h&&(0,t.jsxs)("div",{className:"text-center py-12",children:[(0,t.jsx)("div",{className:"animate-spin text-4xl mb-2",children:"â›³"}),(0,t.jsx)("p",{className:"text-gray-500",children:"Loading ledger..."})]}),!h&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(c,{balances:g,loading:h}),(0,t.jsx)(l.Card,{variant:"outlined",className:"bg-blue-50 border-blue-200 p-4",children:(0,t.jsxs)("p",{className:"text-blue-900 text-sm",children:["ðŸ’¡ ",(0,t.jsx)("span",{className:"font-medium",children:"Settlement Tips:"}),(0,t.jsx)("br",{}),"Settle up offline via Venmo, Zelle, or cash. Mark as settled here when complete."]})}),g.length>0&&(0,t.jsx)(n.Button,{variant:"secondary",fullWidth:!0,children:"View Settlement History"})]}),!h&&0===g.length&&(0,t.jsxs)("div",{className:"text-center py-12",children:[(0,t.jsx)("p",{className:"text-3xl mb-2",children:"âœ…"}),(0,t.jsx)("p",{className:"text-gray-600 font-medium",children:"All settled up!"}),(0,t.jsx)("p",{className:"text-gray-500 text-sm mt-1",children:"No pending balances"})]})]})]})})}e.s(["default",()=>f],23913)}]);