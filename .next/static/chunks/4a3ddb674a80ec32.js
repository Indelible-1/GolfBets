(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,54338,75076,50136,e=>{"use strict";let t;var r=e.i(71645);e.i(51718);var a=e.i(18357),s=e.i(59141);e.i(36180);var o=e.i(98925);let n={toFirestore:e=>({...e,createdAt:o.Timestamp.fromDate(e.createdAt),updatedAt:o.Timestamp.fromDate(e.updatedAt),lastActiveAt:o.Timestamp.fromDate(e.lastActiveAt)}),fromFirestore:e=>{let t=e.data();return{...t,id:e.id,createdAt:t.createdAt.toDate(),updatedAt:t.updatedAt.toDate(),lastActiveAt:t.lastActiveAt.toDate()}}},i={toFirestore:e=>({...e,createdAt:o.Timestamp.fromDate(e.createdAt),updatedAt:o.Timestamp.fromDate(e.updatedAt),startedAt:e.startedAt?o.Timestamp.fromDate(e.startedAt):null,completedAt:e.completedAt?o.Timestamp.fromDate(e.completedAt):null,teeTime:o.Timestamp.fromDate(e.teeTime)}),fromFirestore:e=>{let t=e.data();return{...t,id:e.id,createdAt:t.createdAt.toDate(),updatedAt:t.updatedAt.toDate(),startedAt:t.startedAt?.toDate()??null,completedAt:t.completedAt?.toDate()??null,teeTime:t.teeTime.toDate()}}},c={toFirestore:e=>({...e,invitedAt:o.Timestamp.fromDate(e.invitedAt),confirmedAt:e.confirmedAt?o.Timestamp.fromDate(e.confirmedAt):null}),fromFirestore:e=>{let t=e.data();return{...t,id:e.id,invitedAt:t.invitedAt.toDate(),confirmedAt:t.confirmedAt?.toDate()??null}}},l={toFirestore:e=>({...e,createdAt:o.Timestamp.fromDate(e.createdAt),updatedAt:o.Timestamp.fromDate(e.updatedAt),syncedAt:e.syncedAt?o.Timestamp.fromDate(e.syncedAt):null}),fromFirestore:e=>{let t=e.data();return{...t,id:e.id,createdAt:t.createdAt.toDate(),updatedAt:t.updatedAt.toDate(),syncedAt:t.syncedAt?.toDate()??null}}},d={toFirestore:e=>({...e,createdAt:o.Timestamp.fromDate(e.createdAt)}),fromFirestore:e=>{let t=e.data();return{...t,id:e.id,createdAt:t.createdAt.toDate()}}};function u(){return t||(t=(0,o.getFirestore)()),t}let m=e=>(0,o.doc)((0,o.collection)(u(),"users"),e).withConverter(n);async function h(e){try{let t=await (0,o.getDoc)(m(e));return t.exists()?t.data():null}catch(e){throw console.error("Error fetching user:",e),e}}async function p(e,t){let r=new Date,a={id:e,displayName:t.displayName,email:t.email,avatarUrl:null,handicapIndex:null,homeClub:null,defaultTeeBox:"blue",notificationsEnabled:!0,createdAt:r,updatedAt:r,lastActiveAt:r};try{return await (0,o.setDoc)(m(e),a),a}catch(e){throw console.error("Error creating user:",e),e}}async function f(e,t){try{await (0,o.updateDoc)(m(e),{...t,updatedAt:new Date})}catch(e){throw console.error("Error updating user:",e),e}}async function x(e){try{await (0,o.updateDoc)(m(e),{lastActiveAt:new Date})}catch(e){throw console.error("Error updating user activity:",e),e}}function g(){let[e,t]=(0,r.useState)(null),[o,n]=(0,r.useState)(null),[i,c]=(0,r.useState)(!0),[l,d]=(0,r.useState)(null);return(0,r.useEffect)(()=>{let e=(0,a.onAuthStateChanged)(s.auth,async e=>{try{if(t(e),e){let t=await h(e.uid);if(t)await x(e.uid);else{let r=e.displayName||e.email||"User",a=e.email||"";t=await p(e.uid,{displayName:r,email:a})}n(t),d(null)}else n(null),d(null);c(!1)}catch(e){d(e instanceof Error?e:Error("Unknown auth error")),c(!1)}});return()=>e()},[]),{firebaseUser:e,user:o,loading:i,error:l}}e.s(["betDoc",0,(e,t)=>(0,o.doc)((0,o.collection)(u(),`matches/${e}/bets`),t).withConverter(d),"matchDoc",0,e=>(0,o.doc)((0,o.collection)(u(),"matches"),e).withConverter(i),"matchesCollection",0,()=>(0,o.collection)(u(),"matches").withConverter(i),"participantsCollection",0,e=>(0,o.collection)(u(),`matches/${e}/participants`).withConverter(c),"scoreDoc",0,(e,t)=>(0,o.doc)((0,o.collection)(u(),`matches/${e}/scores`),t).withConverter(l),"scoresCollection",0,e=>(0,o.collection)(u(),`matches/${e}/scores`).withConverter(l),"userDoc",0,m],75076),e.s(["createUser",()=>p,"getUser",()=>h,"updateUser",()=>f,"updateUserActivity",()=>x],50136),e.s(["useAuth",()=>g],54338)},64649,48010,e=>{"use strict";var t=e.i(43476),r=e.i(71645),a=e.i(18566),s=e.i(54338);e.i(84004);var o=e.i(66085);function n({children:e}){let{user:n,loading:i}=(0,s.useAuth)(),c=(0,a.useRouter)();return((0,r.useEffect)(()=>{i||n||c.push("/login")},[n,i,c]),i)?(0,t.jsx)(o.Screen,{className:"flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"animate-spin text-4xl mb-4",children:"â›³"}),(0,t.jsx)("p",{className:"text-gray-500",children:"Loading..."})]})}):n?(0,t.jsx)(t.Fragment,{children:e}):null}e.s(["ProtectedRoute",()=>n],48010),e.s([],64649)},34051,e=>{"use strict";e.i(36180);var t=e.i(98925),r=e.i(75076);async function a(e){try{let a=await (0,t.getDoc)((0,r.matchDoc)(e));return a.exists()?a.data():null}catch(e){throw console.error("Error fetching match:",e),e}}async function s(e,a){try{let s=(0,t.query)((0,r.matchesCollection)(),(0,t.where)("participantIds","array-contains",e)),o=(await (0,t.getDocs)(s)).docs.map(e=>e.data());return a&&(o=o.filter(e=>e.status===a)),o.sort((e,t)=>t.teeTime.getTime()-e.teeTime.getTime())}catch(e){throw console.error("Error fetching user matches:",e),e}}async function o(e,a){let s=new Date,o=`match_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,n={id:o,courseName:a.courseName,courseId:a.courseId||null,teeTime:a.teeTime,holes:a.holes||18,status:"pending",currentHole:null,createdBy:e,scorerId:e,participantIds:[e],createdAt:s,updatedAt:s,startedAt:null,completedAt:null,version:1};try{return await (0,t.setDoc)((0,r.matchDoc)(o),n),n}catch(e){throw console.error("Error creating match:",e),e}}async function n(e,a){try{let s={status:a,updatedAt:new Date};"active"===a?s.startedAt=new Date:"completed"===a&&(s.completedAt=new Date),await (0,t.updateDoc)((0,r.matchDoc)(e),s)}catch(e){throw console.error("Error updating match status:",e),e}}e.s(["createMatch",()=>o,"getMatch",()=>a,"getUserMatches",()=>s,"updateMatchStatus",()=>n])},24483,e=>{"use strict";var t=e.i(71645);e.i(36180);var r=e.i(98925),a=e.i(75076),s=e.i(34051);function o(e){let[o,n]=(0,t.useState)(null),[i,c]=(0,t.useState)([]),[l,d]=(0,t.useState)(!0),[u,m]=(0,t.useState)(null);return(0,t.useEffect)(()=>{if(!e)return;let t=null,o=null;return(async()=>{try{if(!await (0,s.getMatch)(e)){m(Error("Match not found")),d(!1);return}t=(0,r.onSnapshot)((0,a.matchDoc)(e),e=>{e.exists()?(n(e.data()),m(null)):m(Error("Match was deleted"))}),o=(0,r.onSnapshot)((0,a.participantsCollection)(e),e=>{let t=e.docs.map(e=>e.data());c(t),d(!1)},e=>{console.error("Error subscribing to participants:",e),m(e instanceof Error?e:Error("Unknown error")),d(!1)})}catch(e){m(e instanceof Error?e:Error("Unknown error")),d(!1)}})(),()=>{t?.(),o?.()}},[e]),{match:o,participants:i,loading:l,error:u}}e.s(["useMatch",()=>o])},87525,e=>{"use strict";var t=e.i(71645);e.i(36180);var r=e.i(98925);function a(e){let t=new Map;return e.forEach(e=>{t.has(e.fromUserId)||t.set(e.fromUserId,0),t.has(e.toUserId)||t.set(e.toUserId,0)}),e.forEach(e=>{let r=t.get(e.fromUserId)||0,a=t.get(e.toUserId)||0;t.set(e.fromUserId,r-e.amount),t.set(e.toUserId,a+e.amount)}),t}function s(e){return a(e.filter(e=>!e.settled))}function o(e){return Array.from(e.entries()).filter(([,e])=>e<0).map(([e,t])=>({userId:e,amount:Math.abs(t)})).sort((e,t)=>t.amount-e.amount)}function n(e){return Array.from(e.entries()).filter(([,e])=>e>0).map(([e,t])=>({userId:e,amount:t})).sort((e,t)=>t.amount-e.amount)}let i=(0,r.getFirestore)();function c(e){let[c,l]=(0,t.useState)([]),[d,u]=(0,t.useState)(!0),[m,h]=(0,t.useState)(null);(0,t.useEffect)(()=>{if(!e)return;let t=null,a=null;try{let s=(0,r.query)((0,r.collectionGroup)(i,"ledger"),(0,r.where)("fromUserId","==",e)),o=(0,r.query)((0,r.collectionGroup)(i,"ledger"),(0,r.where)("toUserId","==",e));return t=(0,r.onSnapshot)(s,t=>{let r=t.docs.map(e=>e.data());l(t=>{let a=t.filter(t=>t.toUserId===e);return[...r,...a]}),h(null),u(!1)},e=>{console.error("Error subscribing to ledger (from):",e),h(e instanceof Error?e:Error("Unknown error")),u(!1)}),a=(0,r.onSnapshot)(o,t=>{let r=t.docs.map(e=>e.data());l(t=>[...t.filter(t=>t.fromUserId===e),...r]),h(null),u(!1)},e=>{console.error("Error subscribing to ledger (to):",e),h(e instanceof Error?e:Error("Unknown error")),u(!1)}),()=>{t?.(),a?.()}}catch{}},[e]);let p=a(c),f=s(c),x=o(p),g=n(p);return{entries:c,balances:p,unsettledBalances:f,debtors:x,creditors:g,loading:d,error:m}}function l(e){let[c,l]=(0,t.useState)([]),[d,u]=(0,t.useState)(!0),[m,h]=(0,t.useState)(null);(0,t.useEffect)(()=>{if(e)try{let t=(0,r.onSnapshot)((0,r.query)((0,r.collectionGroup)(i,"ledger")),t=>{let r=t.docs.filter(t=>t.ref.parent.parent?.id===e).map(e=>e.data());l(r),h(null),u(!1)},e=>{console.error("Error subscribing to match ledger:",e),h(e instanceof Error?e:Error("Unknown error")),u(!1)});return()=>t()}catch{}},[e]);let p=a(c),f=s(c),x=o(p),g=n(p);return{entries:c,balances:p,unsettledBalances:f,debtors:x,creditors:g,loading:d,error:m}}e.s(["useLedger",()=>c,"useMatchLedger",()=>l],87525)},3170,e=>{"use strict";var t=e.i(43476),r=e.i(71645),a=e.i(22016);e.i(84004);var s=e.i(66085),o=e.i(3374);e.i(16787);var n=e.i(59544),i=e.i(39964),c=e.i(91285);function l({courseName:e,date:r,holes:a,settlements:s,participantNames:o,className:n}){let l=async()=>{let t=`GolfSettled: ${e} - ${a} holes - ${r.toLocaleDateString()}`,s=window.location.href;if(navigator.share)try{await navigator.share({title:"GolfSettled Match Results",text:t,url:s})}catch(e){e instanceof Error&&"AbortError"!==e.name&&console.error("Error sharing:",e)}else{let e=`${t}
${s}`;try{await navigator.clipboard.writeText(e),alert("Results link copied to clipboard!")}catch(e){console.error("Error copying to clipboard:",e)}}},d=s.filter(e=>!e.settled).length;return(0,t.jsxs)(i.Card,{className:(0,c.cn)("overflow-hidden",n),children:[(0,t.jsxs)("div",{className:"bg-gradient-to-r from-fairway-600 to-fairway-700 p-6 text-white",children:[(0,t.jsx)("h2",{className:"text-2xl font-bold mb-1",children:e}),(0,t.jsxs)("p",{className:"text-fairway-100 text-sm mb-4",children:[r.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"})," â€¢ ",a," holes"]}),(0,t.jsxs)("button",{onClick:l,className:"inline-flex items-center gap-2 px-4 py-2 bg-white/20 hover:bg-white/30 rounded-lg text-white text-sm font-medium transition-colors","aria-label":"Share results",children:[(0,t.jsx)("span",{children:"ðŸ“¤"}),"Share"]})]}),(0,t.jsx)(i.CardContent,{className:"pt-6",children:0===s.length?(0,t.jsx)("div",{className:"text-center py-8",children:(0,t.jsx)("p",{className:"text-gray-500 text-sm",children:"No bets to settle"})}):(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)("h3",{className:"text-sm font-semibold text-gray-900 mb-4",children:"Settlements"}),s.map(e=>{let r=o[e.fromUserId]||`Player ${e.fromUserId.slice(0,6)}`,a=o[e.toUserId]||`Player ${e.toUserId.slice(0,6)}`;return(0,t.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,t.jsxs)("div",{className:"flex-1 text-sm",children:[(0,t.jsxs)("p",{className:"text-gray-900 font-medium",children:[r," â†’ ",a]}),(0,t.jsxs)("p",{className:"text-gray-500 text-xs mt-1",children:["nassau"===e.betType?"Nassau":"skins"===e.betType?"Skins":"Bet",e.settled&&" â€¢ Settled"]})]}),(0,t.jsx)("div",{className:"text-right",children:(0,t.jsxs)("p",{className:(0,c.cn)("font-bold text-lg",e.settled?"text-gray-400":"text-fairway-600"),children:["$",e.amount.toFixed(2)]})})]},e.id)}),d>0&&(0,t.jsx)("div",{className:"mt-4 pt-4 border-t border-gray-200",children:(0,t.jsx)("p",{className:"text-xs text-gray-500 italic",children:"ðŸ’¡ Settle up offline via Venmo, Zelle, or cash. Mark as settled in the ledger when done."})})]})})]})}e.i(64649);var d=e.i(48010),u=e.i(54338),m=e.i(24483),h=e.i(87525);e.i(36180);var p=e.i(98925),f=e.i(75076);async function x(e){try{return(await (0,p.getDocs)((0,f.participantsCollection)(e))).docs.map(e=>e.data())}catch(e){throw console.error("Error fetching match participants:",e),e}}var g=e.i(50136);function y({params:e}){let c=e.id,{user:p}=(0,u.useAuth)(),{match:f,loading:y}=(0,m.useMatch)(c),{entries:A,loading:w}=(0,h.useMatchLedger)(c),[v,j]=(0,r.useState)([]),[D,N]=(0,r.useState)(new Map),[b,E]=(0,r.useState)(!0),[S,T]=(0,r.useState)(null);if((0,r.useEffect)(()=>{f&&(async()=>{try{E(!0);let e=await x(c);j(e);let t=new Map,r=e.map(async e=>{let r=await (0,g.getUser)(e.userId);r&&t.set(e.userId,r)});await Promise.all(r),N(t),T(null)}catch(e){console.error("Error fetching participants:",e),T(e instanceof Error?e.message:"Failed to load match data")}finally{E(!1)}})()},[f,c]),y||w||b)return(0,t.jsx)(d.ProtectedRoute,{children:(0,t.jsxs)(s.Screen,{children:[(0,t.jsx)(o.Header,{title:"Results"}),(0,t.jsx)("div",{className:"p-4 flex items-center justify-center h-96",children:(0,t.jsxs)("div",{className:"text-center space-y-2",children:[(0,t.jsx)("div",{className:"animate-spin text-4xl",children:"â›³"}),(0,t.jsx)("p",{className:"text-gray-500",children:"Loading results..."})]})})]})});if(!f||!p)return(0,t.jsx)(d.ProtectedRoute,{children:(0,t.jsxs)(s.Screen,{children:[(0,t.jsx)(o.Header,{title:"Results"}),(0,t.jsx)("div",{className:"p-4",children:(0,t.jsx)(i.Card,{variant:"outlined",className:"bg-red-50 border-red-200",children:(0,t.jsx)("p",{className:"text-red-700 text-sm",children:"Match not found or not authenticated"})})})]})});let U={};v.forEach(e=>{let t=D.get(e.userId);U[e.userId]=t?.displayName||`Player ${e.userId.slice(0,6)}`});let I=A.filter(e=>!e.settled);return(0,t.jsx)(d.ProtectedRoute,{children:(0,t.jsxs)(s.Screen,{padBottom:!0,children:[(0,t.jsx)(o.Header,{title:f.courseName,subtitle:"Match Results"}),(0,t.jsxs)("div",{className:"p-4 pb-24 space-y-6",children:[S&&(0,t.jsx)(i.Card,{variant:"outlined",className:"bg-red-50 border-red-200 p-4",children:(0,t.jsx)("p",{className:"text-red-700 text-sm",children:S})}),(0,t.jsx)(l,{courseName:f.courseName,date:f.teeTime,holes:f.holes,settlements:A,participantNames:U}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,t.jsxs)(i.Card,{variant:"elevated",className:"p-4 text-center",children:[(0,t.jsx)("p",{className:"text-gray-500 text-sm mb-1",children:"Total Bets"}),(0,t.jsx)("p",{className:"text-2xl font-bold text-fairway-600",children:A.length})]}),(0,t.jsxs)(i.Card,{variant:"elevated",className:"p-4 text-center",children:[(0,t.jsx)("p",{className:"text-gray-500 text-sm mb-1",children:"Unsettled"}),(0,t.jsx)("p",{className:"text-2xl font-bold text-orange-600",children:I.length})]})]}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)(a.default,{href:`/match/${c}`,className:"block",children:(0,t.jsx)(n.Button,{variant:"secondary",fullWidth:!0,children:"View Match Details"})}),(0,t.jsx)(a.default,{href:"/ledger",className:"block",children:(0,t.jsx)(n.Button,{fullWidth:!0,children:"View Full Ledger"})})]})]})]})})}e.s(["default",()=>y],3170)}]);