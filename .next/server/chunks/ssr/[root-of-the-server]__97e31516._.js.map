{"version":3,"sources":["../../../../src/hooks/useAuth.ts","../../../../src/lib/firestore/users.ts","../../../../src/lib/firestore/converters.ts","../../../../src/lib/firestore/collections.ts","../../../../src/components/auth/ProtectedRoute.tsx","../../../../src/hooks/useLedger.ts","../../../../src/lib/ledger/balances.ts","../../../../src/app/ledger/page.tsx","../../../../src/components/ledger/BalanceCard.tsx","../../../../src/components/ledger/SettlementList.tsx"],"sourcesContent":["'use client'\n\nimport { useEffect, useState } from 'react'\nimport { onAuthStateChanged, User as FirebaseUser } from 'firebase/auth'\nimport { auth } from '@/lib/firebase'\nimport { User } from '@/types'\nimport { getUser, createUser, updateUserActivity } from '@/lib/firestore/users'\n\ninterface UseAuthReturn {\n  firebaseUser: FirebaseUser | null\n  user: User | null\n  loading: boolean\n  error: Error | null\n}\n\n/**\n * Hook to manage authentication state and Firestore user document\n * Automatically syncs Firebase Auth with Firestore user profile\n */\nexport function useAuth(): UseAuthReturn {\n  const [firebaseUser, setFirebaseUser] = useState<FirebaseUser | null>(null)\n  const [user, setUser] = useState<User | null>(null)\n  const [loading, setLoading] = useState(true)\n  const [error, setError] = useState<Error | null>(null)\n\n  useEffect(() => {\n    const unsubscribe = onAuthStateChanged(auth, async (firebaseUserData) => {\n      try {\n        setFirebaseUser(firebaseUserData)\n\n        if (firebaseUserData) {\n          // User signed in\n          let userData = await getUser(firebaseUserData.uid)\n\n          if (!userData) {\n            // First sign-in: create user document\n            const displayName = firebaseUserData.displayName || firebaseUserData.email || 'User'\n            const email = firebaseUserData.email || ''\n\n            userData = await createUser(firebaseUserData.uid, {\n              displayName,\n              email,\n            })\n          } else {\n            // Update last active timestamp\n            await updateUserActivity(firebaseUserData.uid)\n          }\n\n          setUser(userData)\n          setError(null)\n        } else {\n          // User signed out\n          setUser(null)\n          setError(null)\n        }\n\n        setLoading(false)\n      } catch (err) {\n        const error = err instanceof Error ? err : new Error('Unknown auth error')\n        setError(error)\n        setLoading(false)\n      }\n    })\n\n    return () => unsubscribe()\n  }, [])\n\n  return {\n    firebaseUser,\n    user,\n    loading,\n    error,\n  }\n}\n","import { getDoc, setDoc, updateDoc } from 'firebase/firestore'\nimport { User, TeeBox } from '@/types'\nimport { userDoc } from './collections'\n\n// ============ READ ============\n\n/**\n * Fetch user document by ID\n */\nexport async function getUser(userId: string): Promise<User | null> {\n  try {\n    const snapshot = await getDoc(userDoc(userId))\n    return snapshot.exists() ? snapshot.data() : null\n  } catch (error) {\n    console.error('Error fetching user:', error)\n    throw error\n  }\n}\n\n// ============ CREATE ============\n\n/**\n * Create new user document (called after first sign-in)\n */\nexport async function createUser(\n  userId: string,\n  data: {\n    displayName: string\n    email: string\n  },\n): Promise<User> {\n  const now = new Date()\n  const user: User = {\n    id: userId,\n    displayName: data.displayName,\n    email: data.email,\n    avatarUrl: null,\n\n    // Golf profile defaults\n    handicapIndex: null,\n    homeClub: null,\n    defaultTeeBox: 'blue' as TeeBox,\n\n    // Preferences defaults\n    notificationsEnabled: true,\n\n    // Metadata\n    createdAt: now,\n    updatedAt: now,\n    lastActiveAt: now,\n  }\n\n  try {\n    await setDoc(userDoc(userId), user)\n    return user\n  } catch (error) {\n    console.error('Error creating user:', error)\n    throw error\n  }\n}\n\n// ============ UPDATE ============\n\n/**\n * Update user profile fields (displayName, handicap, etc.)\n */\nexport async function updateUser(\n  userId: string,\n  updates: Partial<Omit<User, 'id' | 'email' | 'createdAt'>>,\n): Promise<void> {\n  try {\n    await updateDoc(userDoc(userId), {\n      ...updates,\n      updatedAt: new Date(),\n    })\n  } catch (error) {\n    console.error('Error updating user:', error)\n    throw error\n  }\n}\n\n/**\n * Update user's last active timestamp (for stale user cleanup)\n */\nexport async function updateUserActivity(userId: string): Promise<void> {\n  try {\n    await updateDoc(userDoc(userId), {\n      lastActiveAt: new Date(),\n    })\n  } catch (error) {\n    console.error('Error updating user activity:', error)\n    throw error\n  }\n}\n\n/**\n * Update user's golf preferences\n */\nexport async function updateUserGolfProfile(\n  userId: string,\n  profile: {\n    handicapIndex?: number | null\n    homeClub?: string | null\n    defaultTeeBox?: TeeBox\n  },\n): Promise<void> {\n  try {\n    await updateDoc(userDoc(userId), {\n      ...profile,\n      updatedAt: new Date(),\n    })\n  } catch (error) {\n    console.error('Error updating golf profile:', error)\n    throw error\n  }\n}\n\n/**\n * Update user notification preferences\n */\nexport async function updateNotificationPreferences(\n  userId: string,\n  notificationsEnabled: boolean,\n): Promise<void> {\n  try {\n    await updateDoc(userDoc(userId), {\n      notificationsEnabled,\n      updatedAt: new Date(),\n    })\n  } catch (error) {\n    console.error('Error updating notification preferences:', error)\n    throw error\n  }\n}\n","import {\n  Timestamp,\n  FirestoreDataConverter,\n  QueryDocumentSnapshot,\n} from 'firebase/firestore'\nimport {\n  User,\n  FirestoreUser,\n  Match,\n  FirestoreMatch,\n  Participant,\n  FirestoreParticipant,\n  Score,\n  FirestoreScore,\n  Bet,\n  FirestoreBet,\n  LedgerEntry,\n  FirestoreLedgerEntry,\n  AuditEntry,\n  FirestoreAuditEntry,\n  Invite,\n  FirestoreInvite,\n} from '@/types'\n\n// ============ TIMESTAMP HELPERS ============\n\nexport const toDate = (timestamp: Timestamp | null | undefined): Date | null => {\n  return timestamp ? timestamp.toDate() : null\n}\n\nexport const fromDate = (date: Date | null | undefined): Timestamp | null => {\n  return date ? Timestamp.fromDate(date) : null\n}\n\n// ============ USER CONVERTER ============\n\nexport const userConverter: FirestoreDataConverter<User> = {\n  toFirestore: (user: User): FirestoreUser => ({\n    ...user,\n    createdAt: Timestamp.fromDate(user.createdAt),\n    updatedAt: Timestamp.fromDate(user.updatedAt),\n    lastActiveAt: Timestamp.fromDate(user.lastActiveAt),\n  }),\n  fromFirestore: (snapshot: QueryDocumentSnapshot<FirestoreUser>): User => {\n    const data = snapshot.data()\n    return {\n      ...data,\n      id: snapshot.id,\n      createdAt: data.createdAt.toDate(),\n      updatedAt: data.updatedAt.toDate(),\n      lastActiveAt: data.lastActiveAt.toDate(),\n    }\n  },\n}\n\n// ============ MATCH CONVERTER ============\n\nexport const matchConverter: FirestoreDataConverter<Match> = {\n  toFirestore: (match: Match): FirestoreMatch => ({\n    ...match,\n    createdAt: Timestamp.fromDate(match.createdAt),\n    updatedAt: Timestamp.fromDate(match.updatedAt),\n    startedAt: match.startedAt ? Timestamp.fromDate(match.startedAt) : null,\n    completedAt: match.completedAt ? Timestamp.fromDate(match.completedAt) : null,\n    teeTime: Timestamp.fromDate(match.teeTime),\n  }),\n  fromFirestore: (snapshot: QueryDocumentSnapshot<FirestoreMatch>): Match => {\n    const data = snapshot.data()\n    return {\n      ...data,\n      id: snapshot.id,\n      createdAt: data.createdAt.toDate(),\n      updatedAt: data.updatedAt.toDate(),\n      startedAt: data.startedAt?.toDate() ?? null,\n      completedAt: data.completedAt?.toDate() ?? null,\n      teeTime: data.teeTime.toDate(),\n    }\n  },\n}\n\n// ============ PARTICIPANT CONVERTER ============\n\nexport const participantConverter: FirestoreDataConverter<Participant> = {\n  toFirestore: (participant: Participant): FirestoreParticipant => ({\n    ...participant,\n    invitedAt: Timestamp.fromDate(participant.invitedAt),\n    confirmedAt: participant.confirmedAt ? Timestamp.fromDate(participant.confirmedAt) : null,\n  }),\n  fromFirestore: (snapshot: QueryDocumentSnapshot<FirestoreParticipant>): Participant => {\n    const data = snapshot.data()\n    return {\n      ...data,\n      id: snapshot.id,\n      invitedAt: data.invitedAt.toDate(),\n      confirmedAt: data.confirmedAt?.toDate() ?? null,\n    }\n  },\n}\n\n// ============ SCORE CONVERTER ============\n\nexport const scoreConverter: FirestoreDataConverter<Score> = {\n  toFirestore: (score: Score): FirestoreScore => ({\n    ...score,\n    createdAt: Timestamp.fromDate(score.createdAt),\n    updatedAt: Timestamp.fromDate(score.updatedAt),\n    syncedAt: score.syncedAt ? Timestamp.fromDate(score.syncedAt) : null,\n  }),\n  fromFirestore: (snapshot: QueryDocumentSnapshot<FirestoreScore>): Score => {\n    const data = snapshot.data()\n    return {\n      ...data,\n      id: snapshot.id,\n      createdAt: data.createdAt.toDate(),\n      updatedAt: data.updatedAt.toDate(),\n      syncedAt: data.syncedAt?.toDate() ?? null,\n    }\n  },\n}\n\n// ============ BET CONVERTER ============\n\nexport const betConverter: FirestoreDataConverter<Bet> = {\n  toFirestore: (bet: Bet): FirestoreBet => ({\n    ...bet,\n    createdAt: Timestamp.fromDate(bet.createdAt),\n  }),\n  fromFirestore: (snapshot: QueryDocumentSnapshot<FirestoreBet>): Bet => {\n    const data = snapshot.data()\n    return {\n      ...data,\n      id: snapshot.id,\n      createdAt: data.createdAt.toDate(),\n    }\n  },\n}\n\n// ============ LEDGER CONVERTER ============\n\nexport const ledgerConverter: FirestoreDataConverter<LedgerEntry> = {\n  toFirestore: (entry: LedgerEntry): FirestoreLedgerEntry => ({\n    ...entry,\n    createdAt: Timestamp.fromDate(entry.createdAt),\n    settledAt: entry.settledAt ? Timestamp.fromDate(entry.settledAt) : null,\n  }),\n  fromFirestore: (snapshot: QueryDocumentSnapshot<FirestoreLedgerEntry>): LedgerEntry => {\n    const data = snapshot.data()\n    return {\n      ...data,\n      id: snapshot.id,\n      createdAt: data.createdAt.toDate(),\n      settledAt: data.settledAt?.toDate() ?? null,\n    }\n  },\n}\n\n// ============ AUDIT CONVERTER ============\n\nexport const auditConverter: FirestoreDataConverter<AuditEntry> = {\n  toFirestore: (entry: AuditEntry): FirestoreAuditEntry => ({\n    ...entry,\n    changedAt: Timestamp.fromDate(entry.changedAt),\n  }),\n  fromFirestore: (snapshot: QueryDocumentSnapshot<FirestoreAuditEntry>): AuditEntry => {\n    const data = snapshot.data()\n    return {\n      ...data,\n      id: snapshot.id,\n      changedAt: data.changedAt.toDate(),\n    }\n  },\n}\n\n// ============ INVITE CONVERTER ============\n\nexport const inviteConverter: FirestoreDataConverter<Invite> = {\n  toFirestore: (invite: Invite): FirestoreInvite => ({\n    ...invite,\n    createdAt: Timestamp.fromDate(invite.createdAt),\n    expiresAt: Timestamp.fromDate(invite.expiresAt),\n  }),\n  fromFirestore: (snapshot: QueryDocumentSnapshot<FirestoreInvite>): Invite => {\n    const data = snapshot.data()\n    return {\n      ...data,\n      id: snapshot.id,\n      createdAt: data.createdAt.toDate(),\n      expiresAt: data.expiresAt.toDate(),\n    }\n  },\n}\n","import {\n  collection,\n  CollectionReference,\n  DocumentReference,\n  doc,\n  getFirestore,\n  Firestore,\n} from 'firebase/firestore'\nimport {\n  User,\n  Match,\n  Participant,\n  Score,\n  Bet,\n  LedgerEntry,\n  AuditEntry,\n  Invite,\n} from '@/types'\nimport {\n  userConverter,\n  matchConverter,\n  participantConverter,\n  scoreConverter,\n  betConverter,\n  ledgerConverter,\n  auditConverter,\n  inviteConverter,\n} from './converters'\n\nlet db: Firestore | undefined\n\nfunction getDb(): Firestore {\n  if (!db) {\n    db = getFirestore()\n  }\n  return db\n}\n\n// ============ ROOT COLLECTIONS ============\n\nexport const usersCollection = (): CollectionReference<User> =>\n  collection(getDb(), 'users').withConverter(userConverter)\n\nexport const matchesCollection = (): CollectionReference<Match> =>\n  collection(getDb(), 'matches').withConverter(matchConverter)\n\nexport const invitesCollection = (): CollectionReference<Invite> =>\n  collection(getDb(), 'invites').withConverter(inviteConverter)\n\n// ============ SUBCOLLECTIONS ============\n\nexport const betsCollection = (matchId: string): CollectionReference<Bet> =>\n  collection(getDb(), `matches/${matchId}/bets`).withConverter(betConverter)\n\nexport const participantsCollection = (matchId: string): CollectionReference<Participant> =>\n  collection(getDb(), `matches/${matchId}/participants`).withConverter(participantConverter)\n\nexport const scoresCollection = (matchId: string): CollectionReference<Score> =>\n  collection(getDb(), `matches/${matchId}/scores`).withConverter(scoreConverter)\n\nexport const ledgerCollection = (matchId: string): CollectionReference<LedgerEntry> =>\n  collection(getDb(), `matches/${matchId}/ledger`).withConverter(ledgerConverter)\n\nexport const auditCollection = (matchId: string): CollectionReference<AuditEntry> =>\n  collection(getDb(), `matches/${matchId}/audit`).withConverter(auditConverter)\n\n// ============ DOCUMENT REFERENCES ============\n\nexport const userDoc = (userId: string): DocumentReference<User> =>\n  doc(collection(getDb(), 'users'), userId).withConverter(userConverter) as DocumentReference<User>\n\nexport const matchDoc = (matchId: string): DocumentReference<Match> =>\n  doc(collection(getDb(), 'matches'), matchId).withConverter(matchConverter) as DocumentReference<Match>\n\nexport const betDoc = (matchId: string, betId: string): DocumentReference<Bet> =>\n  doc(collection(getDb(), `matches/${matchId}/bets`), betId).withConverter(betConverter) as DocumentReference<Bet>\n\nexport const participantDoc = (\n  matchId: string,\n  participantId: string,\n): DocumentReference<Participant> =>\n  doc(\n    collection(getDb(), `matches/${matchId}/participants`),\n    participantId,\n  ).withConverter(participantConverter) as DocumentReference<Participant>\n\nexport const scoreDoc = (matchId: string, scoreId: string): DocumentReference<Score> =>\n  doc(collection(getDb(), `matches/${matchId}/scores`), scoreId).withConverter(\n    scoreConverter,\n  ) as DocumentReference<Score>\n\nexport const ledgerEntryDoc = (\n  matchId: string,\n  entryId: string,\n): DocumentReference<LedgerEntry> =>\n  doc(collection(getDb(), `matches/${matchId}/ledger`), entryId).withConverter(\n    ledgerConverter,\n  ) as DocumentReference<LedgerEntry>\n\nexport const auditEntryDoc = (\n  matchId: string,\n  auditId: string,\n): DocumentReference<AuditEntry> =>\n  doc(collection(getDb(), `matches/${matchId}/audit`), auditId).withConverter(\n    auditConverter,\n  ) as DocumentReference<AuditEntry>\n\nexport const inviteDoc = (inviteId: string): DocumentReference<Invite> =>\n  doc(collection(getDb(), 'invites'), inviteId).withConverter(\n    inviteConverter,\n  ) as DocumentReference<Invite>\n","'use client'\n\nimport { useEffect } from 'react'\nimport { useRouter } from 'next/navigation'\nimport { useAuth } from '@/hooks/useAuth'\nimport { Screen } from '@/components/layout'\n\ninterface ProtectedRouteProps {\n  children: React.ReactNode\n}\n\nexport function ProtectedRoute({ children }: ProtectedRouteProps) {\n  const { user, loading } = useAuth()\n  const router = useRouter()\n\n  useEffect(() => {\n    if (!loading && !user) {\n      router.push('/login')\n    }\n  }, [user, loading, router])\n\n  if (loading) {\n    return (\n      <Screen className=\"flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin text-4xl mb-4\">â›³</div>\n          <p className=\"text-gray-500\">Loading...</p>\n        </div>\n      </Screen>\n    )\n  }\n\n  if (!user) {\n    return null\n  }\n\n  return <>{children}</>\n}\n","'use client'\n\nimport { useEffect, useState } from 'react'\nimport { collectionGroup, onSnapshot, query, where, getFirestore } from 'firebase/firestore'\nimport { LedgerEntry } from '@/types'\nimport { calculateMatchBalances, calculateUnsettledBalances, getDebtors, getCreditors } from '@/lib/ledger/balances'\n\nconst db = getFirestore()\n\ninterface UseLedgerReturn {\n  entries: LedgerEntry[]\n  balances: Map<string, number>\n  unsettledBalances: Map<string, number>\n  debtors: Array<{ userId: string; amount: number }>\n  creditors: Array<{ userId: string; amount: number }>\n  loading: boolean\n  error: Error | null\n}\n\n/**\n * Hook to fetch user's ledger entries across all matches with real-time updates\n * Uses collectionGroup to query ledger subcollections\n *\n * @param userId User ID to fetch ledger for\n * @returns Ledger entries, balances, and loading state\n */\nexport function useLedger(userId: string | null): UseLedgerReturn {\n  const [entries, setEntries] = useState<LedgerEntry[]>([])\n  const [loading, setLoading] = useState(true)\n  const [error, setError] = useState<Error | null>(null)\n\n  useEffect(() => {\n    if (!userId) {\n      return\n    }\n\n    let unsubscribeFrom: (() => void) | null = null\n    let unsubscribeTo: (() => void) | null = null\n\n    try {\n      // Query where user is the debtor (fromUserId)\n      const fromUserQuery = query(\n        collectionGroup(db, 'ledger'),\n        where('fromUserId', '==', userId),\n      )\n\n      // Query where user is the creditor (toUserId)\n      const toUserQuery = query(collectionGroup(db, 'ledger'), where('toUserId', '==', userId))\n\n      unsubscribeFrom = onSnapshot(\n        fromUserQuery,\n        (snapshot) => {\n          const fromEntries = snapshot.docs.map((doc) => doc.data() as LedgerEntry)\n          setEntries((prevEntries) => {\n            const toEntries = prevEntries.filter((entry) => entry.toUserId === userId)\n            return [...fromEntries, ...toEntries]\n          })\n          setError(null)\n          setLoading(false)\n        },\n        (err) => {\n          console.error('Error subscribing to ledger (from):', err)\n          setError(err instanceof Error ? err : new Error('Unknown error'))\n          setLoading(false)\n        },\n      )\n\n      unsubscribeTo = onSnapshot(\n        toUserQuery,\n        (snapshot) => {\n          const toEntries = snapshot.docs.map((doc) => doc.data() as LedgerEntry)\n          setEntries((prevEntries) => {\n            const fromEntries = prevEntries.filter((entry) => entry.fromUserId === userId)\n            return [...fromEntries, ...toEntries]\n          })\n          setError(null)\n          setLoading(false)\n        },\n        (err) => {\n          console.error('Error subscribing to ledger (to):', err)\n          setError(err instanceof Error ? err : new Error('Unknown error'))\n          setLoading(false)\n        },\n      )\n\n      return () => {\n        unsubscribeFrom?.()\n        unsubscribeTo?.()\n      }\n    } catch {\n      // Silently catch setup errors - error is already handled in onSnapshot error handler\n    }\n  }, [userId])\n\n  // Calculate derived values\n  const balances = calculateMatchBalances(entries)\n  const unsettledBalances = calculateUnsettledBalances(entries)\n  const debtors = getDebtors(balances)\n  const creditors = getCreditors(balances)\n\n  return {\n    entries,\n    balances,\n    unsettledBalances,\n    debtors,\n    creditors,\n    loading,\n    error,\n  }\n}\n\n/**\n * Hook to fetch ledger entries for a specific match with real-time updates\n *\n * @param matchId Match ID to fetch ledger for\n * @returns Match ledger entries with balances\n */\nexport function useMatchLedger(matchId: string | null) {\n  const [entries, setEntries] = useState<LedgerEntry[]>([])\n  const [loading, setLoading] = useState(true)\n  const [error, setError] = useState<Error | null>(null)\n\n  useEffect(() => {\n    if (!matchId) {\n      return\n    }\n\n    try {\n      const unsubscribe = onSnapshot(\n        query(collectionGroup(db, 'ledger')),\n        (snapshot) => {\n          // Filter to only this match (match path is in documentRef)\n          const matchEntries = snapshot.docs\n            .filter((doc) => doc.ref.parent.parent?.id === matchId)\n            .map((doc) => doc.data() as LedgerEntry)\n          setEntries(matchEntries)\n          setError(null)\n          setLoading(false)\n        },\n        (err) => {\n          console.error('Error subscribing to match ledger:', err)\n          setError(err instanceof Error ? err : new Error('Unknown error'))\n          setLoading(false)\n        },\n      )\n\n      return () => unsubscribe()\n    } catch {\n      // Silently catch setup errors - error is already handled in onSnapshot error handler\n    }\n  }, [matchId])\n\n  const balances = calculateMatchBalances(entries)\n  const unsettledBalances = calculateUnsettledBalances(entries)\n  const debtors = getDebtors(balances)\n  const creditors = getCreditors(balances)\n\n  return {\n    entries,\n    balances,\n    unsettledBalances,\n    debtors,\n    creditors,\n    loading,\n    error,\n  }\n}\n","import { LedgerEntry } from '@/types'\n\n/**\n * Balance for a single user in a transaction\n */\nexport interface UserBalance {\n  userId: string\n  amount: number // Positive = owed money, negative = owes money\n}\n\n/**\n * Net balance between two specific users (who owes whom)\n */\nexport interface PairwiseBalance {\n  userId: string\n  otherUserId: string\n  amount: number // Positive = userId owes otherUserId, negative = otherUserId owes userId\n}\n\n/**\n * Calculate the net balance for a user across ledger entries\n * Positive = user is owed money, negative = user owes money\n * @param userId User to calculate balance for\n * @param entries Ledger entries to include\n * @returns Net balance amount\n */\nexport function calculateUserBalance(userId: string, entries: LedgerEntry[]): number {\n  return entries.reduce((balance, entry) => {\n    // If user is receiving money (toUserId)\n    if (entry.toUserId === userId) {\n      return balance + entry.amount\n    }\n    // If user is paying money (fromUserId)\n    if (entry.fromUserId === userId) {\n      return balance - entry.amount\n    }\n    return balance\n  }, 0)\n}\n\n/**\n * Calculate balances for all participants in a match\n * Returns who owes whom and how much\n * @param entries Ledger entries for the match\n * @returns Map of userId -> net balance\n */\nexport function calculateMatchBalances(\n  entries: LedgerEntry[],\n): Map<string, number> {\n  const balances = new Map<string, number>()\n\n  // Initialize all users with 0 balance\n  entries.forEach((entry) => {\n    if (!balances.has(entry.fromUserId)) balances.set(entry.fromUserId, 0)\n    if (!balances.has(entry.toUserId)) balances.set(entry.toUserId, 0)\n  })\n\n  // Calculate balances\n  entries.forEach((entry) => {\n    const fromBalance = balances.get(entry.fromUserId) || 0\n    const toBalance = balances.get(entry.toUserId) || 0\n\n    balances.set(entry.fromUserId, fromBalance - entry.amount)\n    balances.set(entry.toUserId, toBalance + entry.amount)\n  })\n\n  return balances\n}\n\n/**\n * Get unsettled balance for all users in a match\n * Only includes entries where settled === false\n * @param entries Ledger entries for the match\n * @returns Map of userId -> unsettled balance\n */\nexport function calculateUnsettledBalances(\n  entries: LedgerEntry[],\n): Map<string, number> {\n  const unsettledEntries = entries.filter((entry) => !entry.settled)\n  return calculateMatchBalances(unsettledEntries)\n}\n\n/**\n * Calculate who owes money (debtors) in a match\n * Returns users with negative balance and how much they owe\n * @param balances Balance map from calculateMatchBalances()\n * @returns Array of { userId, amount owed }\n */\nexport function getDebtors(balances: Map<string, number>): UserBalance[] {\n  return Array.from(balances.entries())\n    .filter(([, amount]) => amount < 0)\n    .map(([userId, amount]) => ({\n      userId,\n      amount: Math.abs(amount),\n    }))\n    .sort((a, b) => b.amount - a.amount) // Sort descending by amount\n}\n\n/**\n * Calculate who is owed money (creditors) in a match\n * Returns users with positive balance and how much they're owed\n * @param balances Balance map from calculateMatchBalances()\n * @returns Array of { userId, amount owed }\n */\nexport function getCreditors(balances: Map<string, number>): UserBalance[] {\n  return Array.from(balances.entries())\n    .filter(([, amount]) => amount > 0)\n    .map(([userId, amount]) => ({\n      userId,\n      amount,\n    }))\n    .sort((a, b) => b.amount - a.amount) // Sort descending by amount\n}\n\n/**\n * Calculate net balance between two specific users\n * Positive = first user owes second user\n * Negative = second user owes first user\n * @param userId1 First user ID\n * @param userId2 Second user ID\n * @param entries Ledger entries to consider\n * @returns Net amount between users\n */\nexport function calculatePairwiseBalance(\n  userId1: string,\n  userId2: string,\n  entries: LedgerEntry[],\n): number {\n  const relevantEntries = entries.filter(\n    (entry) =>\n      (entry.fromUserId === userId1 && entry.toUserId === userId2) ||\n      (entry.fromUserId === userId2 && entry.toUserId === userId1),\n  )\n\n  let balance = 0\n  relevantEntries.forEach((entry) => {\n    if (entry.fromUserId === userId1 && entry.toUserId === userId2) {\n      balance += entry.amount // userId1 owes userId2\n    } else {\n      balance -= entry.amount // userId2 owes userId1\n    }\n  })\n\n  return balance\n}\n\n/**\n * Get all pairwise balances for unsettled entries in a match\n * Useful for settlement UI to show who owes whom\n * @param entries Ledger entries for the match\n * @returns Array of unique pairwise balances\n */\nexport function getPairwiseBalances(entries: LedgerEntry[]): PairwiseBalance[] {\n  const unsettledEntries = entries.filter((entry) => !entry.settled)\n  const pairwises = new Map<string, number>()\n\n  // Create a key for each unique pair\n  unsettledEntries.forEach((entry) => {\n    const key = [entry.fromUserId, entry.toUserId].sort().join('|')\n    const existing = pairwises.get(key) || 0\n\n    if (entry.fromUserId < entry.toUserId) {\n      pairwises.set(key, existing + entry.amount)\n    } else {\n      pairwises.set(key, existing - entry.amount)\n    }\n  })\n\n  // Convert to PairwiseBalance array\n  return Array.from(pairwises.entries())\n    .map(([key, amount]) => {\n      const [userId1, userId2] = key.split('|')\n      return {\n        userId: userId1,\n        otherUserId: userId2,\n        amount,\n      }\n    })\n    .filter((pair) => pair.amount !== 0) // Exclude settled pairs\n    .sort((a, b) => Math.abs(b.amount) - Math.abs(a.amount)) // Sort by magnitude\n}\n\n/**\n * Check if a user has any unsettled debts in a match\n * @param userId User to check\n * @param entries Ledger entries for the match\n * @returns true if user owes money, false otherwise\n */\nexport function userHasUnsettledDebts(userId: string, entries: LedgerEntry[]): boolean {\n  const unsettledEntries = entries.filter((entry) => !entry.settled)\n  const balance = calculateUserBalance(userId, unsettledEntries)\n  return balance < 0\n}\n","'use client'\n\nimport { useState } from 'react'\nimport { Screen, Header } from '@/components/layout'\nimport { Card, Button } from '@/components/ui'\nimport { SettlementList } from '@/components/ledger'\nimport { ProtectedRoute } from '@/components/auth'\nimport { useAuth } from '@/hooks/useAuth'\nimport { useLedger } from '@/hooks/useLedger'\n\ninterface Balance {\n  userId: string\n  name: string\n  amount: number // Positive = owed to me, negative = I owe\n  canSettle?: boolean\n  onSettle?: (userId: string) => Promise<void>\n}\n\nexport default function LedgerPage() {\n  const { firebaseUser } = useAuth()\n  const userId = firebaseUser?.uid || null\n  const { entries: ledgerEntries, balances, loading, error } = useLedger(userId)\n  const [settlingError, setSettlingError] = useState<string | null>(null)\n\n  // Transform balances into display format\n  const displayBalances: Balance[] = Array.from(balances.entries()).map(([otherUserId, amount]) => ({\n    userId: otherUserId,\n    name: `Player ${otherUserId.slice(0, 6)}`,\n    amount,\n    canSettle: true,\n    onSettle: async () => {\n      try {\n        setSettlingError(null)\n        // Find the ledger entries between current user and this user that are unsettled\n        const entriesToSettle = ledgerEntries.filter(\n          (entry) =>\n            !entry.settled &&\n            ((entry.fromUserId === userId && entry.toUserId === otherUserId) ||\n              (entry.fromUserId === otherUserId && entry.toUserId === userId)),\n        )\n\n        // Mark all as settled\n        for (const entry of entriesToSettle) {\n          // Need to extract matchId from entry - it's in the parent reference\n          // For now, we'll need to track this differently or store it in the entry\n          // Workaround: find the match that contains this ledger entry\n          console.log('Settling entry:', entry.id)\n        }\n      } catch (err) {\n        console.error('Error settling:', err)\n        setSettlingError(err instanceof Error ? err.message : 'Failed to settle')\n      }\n    },\n  }))\n\n  return (\n    <ProtectedRoute>\n      <Screen padBottom>\n        <Header title=\"Ledger\" subtitle=\"Your Balances\" />\n\n        <div className=\"p-4 pb-24 space-y-6\">\n          {/* Error Message */}\n          {(error || settlingError) && (\n            <Card variant=\"outlined\" className=\"bg-red-50 border-red-200 p-4\">\n              <p className=\"text-red-700 text-sm\">{error?.message || settlingError}</p>\n            </Card>\n          )}\n\n          {/* Summary Cards */}\n          {!loading && (\n            <div className=\"grid grid-cols-2 gap-3\">\n              {/* You're Owed */}\n              <Card variant=\"elevated\" className=\"p-4\">\n                <p className=\"text-gray-500 text-sm mb-1\">You&apos;re Owed</p>\n                <p className=\"text-2xl font-bold text-fairway-600\">\n                  ${Array.from(balances.values())\n                    .filter((b) => b > 0)\n                    .reduce((sum, b) => sum + b, 0)\n                    .toFixed(2)}\n                </p>\n              </Card>\n\n              {/* You Owe */}\n              <Card variant=\"elevated\" className=\"p-4\">\n                <p className=\"text-gray-500 text-sm mb-1\">You Owe</p>\n                <p className=\"text-2xl font-bold text-red-600\">\n                  ${Math.abs(\n                    Array.from(balances.values())\n                      .filter((b) => b < 0)\n                      .reduce((sum, b) => sum + b, 0),\n                  ).toFixed(2)}\n                </p>\n              </Card>\n            </div>\n          )}\n\n          {/* Loading State */}\n          {loading && (\n            <div className=\"text-center py-12\">\n              <div className=\"animate-spin text-4xl mb-2\">â›³</div>\n              <p className=\"text-gray-500\">Loading ledger...</p>\n            </div>\n          )}\n\n          {/* Settlement List */}\n          {!loading && (\n            <>\n              <SettlementList\n                balances={displayBalances}\n                loading={loading}\n              />\n\n              {/* Info Banner */}\n              <Card variant=\"outlined\" className=\"bg-blue-50 border-blue-200 p-4\">\n                <p className=\"text-blue-900 text-sm\">\n                  ðŸ’¡ <span className=\"font-medium\">Settlement Tips:</span>\n                  <br />\n                  Settle up offline via Venmo, Zelle, or cash. Mark as settled here when complete.\n                </p>\n              </Card>\n\n              {/* Settle All Button */}\n              {displayBalances.length > 0 && (\n                <Button variant=\"secondary\" fullWidth>\n                  View Settlement History\n                </Button>\n              )}\n            </>\n          )}\n\n          {/* Empty State */}\n          {!loading && displayBalances.length === 0 && (\n            <div className=\"text-center py-12\">\n              <p className=\"text-3xl mb-2\">âœ…</p>\n              <p className=\"text-gray-600 font-medium\">All settled up!</p>\n              <p className=\"text-gray-500 text-sm mt-1\">No pending balances</p>\n            </div>\n          )}\n        </div>\n      </Screen>\n    </ProtectedRoute>\n  )\n}\n","'use client'\n\nimport { Card } from '@/components/ui'\nimport { cn } from '@/lib/utils'\n\ninterface BalanceCardProps {\n  name: string\n  amount: number // Positive = owed to this player, negative = this player owes\n  onSettle?: () => Promise<void>\n  isSettling?: boolean\n  className?: string\n}\n\nexport function BalanceCard({\n  name,\n  amount,\n  onSettle,\n  isSettling = false,\n  className,\n}: BalanceCardProps) {\n  const isOwed = amount > 0\n  const absoluteAmount = Math.abs(amount)\n\n  return (\n    <Card variant=\"outlined\" className={cn('p-4', className)}>\n      <div className=\"flex items-center justify-between\">\n        <div className=\"flex-1\">\n          <h3 className=\"font-semibold text-gray-900\">{name}</h3>\n          <p\n            className={cn('text-sm mt-1 font-medium', isOwed ? 'text-fairway-600' : 'text-red-600')}\n          >\n            {isOwed ? 'âœ“ Owes you' : 'â€¢ You owe'}\n          </p>\n        </div>\n\n        <div className=\"text-right\">\n          <p className={cn('text-2xl font-bold', isOwed ? 'text-fairway-600' : 'text-red-600')}>\n            ${absoluteAmount.toFixed(2)}\n          </p>\n        </div>\n      </div>\n\n      {onSettle && (\n        <button\n          onClick={onSettle}\n          disabled={isSettling}\n          className={cn(\n            'w-full mt-4 px-3 py-2 rounded-lg text-sm font-medium transition-colors',\n            isSettling\n              ? 'bg-gray-100 text-gray-400 cursor-not-allowed'\n              : 'bg-gray-100 hover:bg-gray-200 text-gray-900',\n          )}\n          aria-label={`Mark ${name} as settled`}\n        >\n          {isSettling ? 'Marking...' : 'Mark Settled'}\n        </button>\n      )}\n    </Card>\n  )\n}\n","'use client'\n\nimport { useState } from 'react'\nimport { BalanceCard } from './BalanceCard'\nimport { cn } from '@/lib/utils'\n\ninterface Balance {\n  userId: string\n  name: string\n  amount: number // Positive = owed to me, negative = I owe\n  canSettle?: boolean\n  onSettle?: (userId: string) => Promise<void>\n}\n\ninterface SettlementListProps {\n  balances: Balance[]\n  loading?: boolean\n  className?: string\n}\n\nexport function SettlementList({\n  balances,\n  loading = false,\n  className,\n}: SettlementListProps) {\n  const [settlingUserId, setSettlingUserId] = useState<string | null>(null)\n\n  const handleSettle = async (userId: string, onSettle?: (userId: string) => Promise<void>) => {\n    if (!onSettle) return\n\n    setSettlingUserId(userId)\n    try {\n      await onSettle(userId)\n    } catch (err) {\n      console.error('Error settling balance:', err)\n    } finally {\n      setSettlingUserId(null)\n    }\n  }\n\n  // Sort: people who owe me first, then people I owe\n  const sortedBalances = [...balances].sort((a, b) => {\n    const aOwedToMe = a.amount > 0 ? 1 : 0\n    const bOwedToMe = b.amount > 0 ? 1 : 0\n\n    if (aOwedToMe !== bOwedToMe) {\n      return bOwedToMe - aOwedToMe // People owing to me first\n    }\n\n    // Within same category, sort by amount descending\n    return Math.abs(b.amount) - Math.abs(a.amount)\n  })\n\n  if (balances.length === 0) {\n    return (\n      <div className={cn('text-center py-12', className)}>\n        <p className=\"text-3xl mb-2\">âœ…</p>\n        <p className=\"text-gray-600 font-medium\">All settled up!</p>\n        <p className=\"text-gray-500 text-sm mt-1\">No pending settlements</p>\n      </div>\n    )\n  }\n\n  return (\n    <div className={cn('space-y-3', className)}>\n      {loading && (\n        <div className=\"text-center py-8\">\n          <div className=\"animate-spin text-4xl mb-2\">â›³</div>\n          <p className=\"text-gray-500 text-sm\">Loading settlements...</p>\n        </div>\n      )}\n\n      {!loading &&\n        sortedBalances.map((balance) => (\n          <BalanceCard\n            key={balance.userId}\n            name={balance.name}\n            amount={balance.amount}\n            onSettle={\n              balance.canSettle && balance.onSettle\n                ? () => handleSettle(balance.userId, balance.onSettle)\n                : undefined\n            }\n            isSettling={settlingUserId === balance.userId}\n          />\n        ))}\n    </div>\n  )\n}\n"],"names":[],"mappings":"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"}