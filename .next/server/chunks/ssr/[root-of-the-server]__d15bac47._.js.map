{"version":3,"sources":["../../../../src/lib/auth/config.ts","../../../../src/app/%28auth%29/callback/page.tsx"],"sourcesContent":["import {\n  sendSignInLinkToEmail,\n  isSignInWithEmailLink,\n  signInWithEmailLink,\n  signOut,\n  signInWithPopup,\n  GoogleAuthProvider,\n  UserCredential,\n} from 'firebase/auth'\nimport { auth } from '@/lib/firebase'\n\n// ============ MAGIC LINK AUTH ============\n\n/**\n * Send magic link to user's email for passwordless sign-in\n * @param email User's email address\n */\nexport async function sendMagicLink(email: string): Promise<void> {\n  const actionCodeSettings = {\n    url: `${process.env.NEXT_PUBLIC_APP_URL}/auth/callback`,\n    handleCodeInApp: true,\n  }\n\n  try {\n    await sendSignInLinkToEmail(auth, email, actionCodeSettings)\n    // Store email in localStorage so user can confirm it after clicking link\n    localStorage.setItem('emailForSignIn', email)\n  } catch (error) {\n    console.error('Error sending magic link:', error)\n    throw error\n  }\n}\n\n/**\n * Complete sign-in with magic link from email\n * @returns UserCredential if successful\n */\nexport async function completeMagicLink(): Promise<UserCredential | null> {\n  if (!isSignInWithEmailLink(auth, window.location.href)) {\n    return null\n  }\n\n  const email = localStorage.getItem('emailForSignIn')\n  if (!email) {\n    throw new Error('No email found for magic link sign-in')\n  }\n\n  try {\n    const result = await signInWithEmailLink(auth, email, window.location.href)\n    localStorage.removeItem('emailForSignIn')\n    return result\n  } catch (error) {\n    console.error('Error completing magic link sign-in:', error)\n    throw error\n  }\n}\n\n// ============ GOOGLE OAUTH ============\n\n/**\n * Sign in with Google OAuth\n * @returns UserCredential if successful\n */\nexport async function signInWithGoogle(): Promise<UserCredential> {\n  const provider = new GoogleAuthProvider()\n\n  try {\n    return await signInWithPopup(auth, provider)\n  } catch (error) {\n    console.error('Error signing in with Google:', error)\n    throw error\n  }\n}\n\n// ============ SIGN OUT ============\n\n/**\n * Sign out current user\n */\nexport async function signOutUser(): Promise<void> {\n  try {\n    await signOut(auth)\n  } catch (error) {\n    console.error('Error signing out:', error)\n    throw error\n  }\n}\n\n","'use client'\n\nimport { useEffect, useState } from 'react'\nimport { useRouter } from 'next/navigation'\nimport { completeMagicLink } from '@/lib/auth/config'\nimport { Screen } from '@/components/layout'\nimport { Card } from '@/components/ui'\n\nexport default function AuthCallbackPage() {\n  const router = useRouter()\n  const [error, setError] = useState<string | null>(null)\n  const [isProcessing, setIsProcessing] = useState(true)\n\n  useEffect(() => {\n    const handleCallback = async () => {\n      try {\n        const result = await completeMagicLink()\n\n        if (!result) {\n          throw new Error('Invalid magic link or link already used')\n        }\n\n        // Success! Redirect to home\n        setTimeout(() => {\n          router.push('/')\n        }, 500)\n      } catch (err) {\n        setError(err instanceof Error ? err.message : 'Failed to sign in')\n        setIsProcessing(false)\n      }\n    }\n\n    handleCallback()\n  }, [router])\n\n  if (isProcessing) {\n    return (\n      <Screen className=\"flex items-center justify-center\">\n        <div className=\"text-center space-y-4\">\n          <div className=\"animate-spin text-4xl\">⛳</div>\n          <p className=\"text-gray-600 font-medium\">Signing you in...</p>\n          <p className=\"text-sm text-gray-500\">Please wait while we verify your email</p>\n        </div>\n      </Screen>\n    )\n  }\n\n  if (error) {\n    return (\n      <Screen>\n        <div className=\"p-4 max-w-md mx-auto pt-12\">\n          <Card variant=\"elevated\" className=\"bg-red-50 border border-red-200\">\n            <div className=\"text-center space-y-4\">\n              <div className=\"text-4xl\">❌</div>\n              <div>\n                <h2 className=\"text-lg font-semibold text-red-900 mb-2\">Sign In Failed</h2>\n                <p className=\"text-sm text-red-700 mb-4\">{error}</p>\n              </div>\n\n              <div className=\"space-y-3\">\n                <p className=\"text-sm text-gray-600\">\n                  The link may have expired or been used already.\n                </p>\n                <a\n                  href=\"/login\"\n                  className=\"inline-block px-6 py-3 bg-red-600 text-white rounded-lg font-semibold hover:bg-red-700 transition-colors min-h-[48px] min-w-[48px] flex items-center justify-center\"\n                >\n                  Try Again\n                </a>\n              </div>\n            </div>\n          </Card>\n        </div>\n      </Screen>\n    )\n  }\n\n  return null\n}\n"],"names":[],"mappings":"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"}