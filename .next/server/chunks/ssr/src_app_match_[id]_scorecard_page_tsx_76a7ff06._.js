module.exports=[39380,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(38246);a.i(45600);var e=a.i(30400),f=a.i(43218);a.i(11909);var g=a.i(62067),h=a.i(96438),i=a.i(48313),j=a.i(79530);function k({holeNumber:a,par:c,score:d,onScoreChange:e,disabled:f=!1,className:g}){let h=void 0!==d?d-c:0;return(0,b.jsxs)("div",{className:(0,j.cn)("flex flex-col items-center gap-2 p-3 rounded-lg border border-gray-200","tap-target",f&&"opacity-50 cursor-not-allowed",g),children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 w-full justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)("span",{className:"text-xs font-semibold text-gray-600 uppercase",children:"Hole"}),(0,b.jsx)("span",{className:"text-sm font-bold text-gray-900",children:a})]}),(0,b.jsxs)("span",{className:"text-xs font-semibold text-gray-600",children:["Par ",c]})]}),(0,b.jsx)("div",{className:(0,j.cn)("w-full h-16 rounded-lg flex items-center justify-center","border-2 border-gray-300 transition-all",void 0===d?"bg-gray-100":h<0?"bg-fairway-50":h>0?"bg-red-50":"bg-white",void 0===d?"text-gray-900":h<0?"text-fairway-600":h>0?"text-red-600":"text-gray-900"),children:(0,b.jsxs)("div",{className:"flex flex-col items-center",children:[(0,b.jsx)("span",{className:"text-2xl font-bold",children:void 0===d?"-":d.toString()}),void 0!==d&&(0,b.jsx)("span",{className:"text-xs font-semibold",children:(a=>{if(void 0===a)return"";let b=a-c;return 0===b?"E":b>0?`+${b}`:`${b}`})(d)})]})}),(0,b.jsxs)("div",{className:"flex gap-2 w-full",children:[(0,b.jsx)("button",{onClick:()=>{void 0===d?e(c-1):d>1&&e(d-1)},disabled:f||void 0===d&&c<=1||void 0!==d&&d<=1,className:(0,j.cn)("flex-1 h-12 rounded-lg font-bold text-lg transition-colors","tap-target","border-2 border-gray-300 bg-white text-gray-900","hover:bg-gray-50 hover:border-gray-400","disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:bg-white disabled:hover:border-gray-300","focus:outline-none focus:ring-2 focus:ring-fairway-500 focus:ring-offset-2"),"aria-label":`Decrease score for hole ${a}`,children:"−"}),(0,b.jsx)("button",{onClick:()=>{void 0===d?e(c+1):d<20&&e(d+1)},disabled:f||void 0!==d&&d>=20,className:(0,j.cn)("flex-1 h-12 rounded-lg font-bold text-lg transition-colors","tap-target","border-2 border-gray-300 bg-white text-gray-900","hover:bg-gray-50 hover:border-gray-400","disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:bg-white disabled:hover:border-gray-300","focus:outline-none focus:ring-2 focus:ring-fairway-500 focus:ring-offset-2"),"aria-label":`Increase score for hole ${a}`,children:"+"})]})]})}function l({currentHole:a,totalHoles:c,totalStrokes:d,totalPar:e,className:f}){let g=void 0!==d?d-e:0;return(0,b.jsxs)("div",{className:(0,j.cn)("grid grid-cols-3 gap-2 p-4 bg-gray-50 rounded-lg border border-gray-200",f),children:[(0,b.jsxs)("div",{className:"flex flex-col items-center gap-1",children:[(0,b.jsx)("span",{className:"text-xs text-gray-600 uppercase font-semibold",children:"Thru"}),(0,b.jsxs)("span",{className:"text-xl font-bold text-gray-900",children:[a,"/",c]})]}),(0,b.jsxs)("div",{className:"flex flex-col items-center gap-1",children:[(0,b.jsx)("span",{className:"text-xs text-gray-600 uppercase font-semibold",children:"Total"}),(0,b.jsx)("span",{className:"text-xl font-bold text-gray-900",children:void 0===d?"-":d})]}),(0,b.jsxs)("div",{className:"flex flex-col items-center gap-1",children:[(0,b.jsx)("span",{className:"text-xs text-gray-600 uppercase font-semibold",children:"To Par"}),(0,b.jsx)("span",{className:(0,j.cn)("text-xl font-bold",void 0===d?"text-gray-600":g<0?"text-fairway-600":g>0?"text-red-600":"text-gray-900"),children:void 0===d||0===g?"E":g>0?`+${g}`:`${g}`})]})]})}let m=[4,4,3,5,4,4,3,4,5,4,4,3,5,4,4,3,4,5],n=[4,4,3,5,4,4,3,4,5];function o({totalHoles:a,currentUserScores:c,allParticipantScores:d,participantNames:e,onScoreChange:f,loading:h=!1,className:i}){let o=18===a?m:n,p=o.reduce((a,b)=>a+b,0),q=Object.values(c).reduce((a,b)=>a+(b||0),0)||void 0,r=Object.values(c).filter(a=>void 0!==a).length,s=Object.entries(d).map(([a,b])=>{let c=Object.values(b).reduce((a,b)=>a+(b||0),0)||void 0,d=Object.values(b).filter(a=>void 0!==a).length;return{userId:a,name:e[a]||`Player ${a.slice(0,6)}`,total:c||0,entered:d,toPar:void 0!==c?c-(o.slice(0,d).reduce((a,b)=>a+b,0)||p):0}}).sort((a,b)=>a.entered!==b.entered?b.entered-a.entered:a.total-b.total),t=async(a,b)=>{await f(a,b)};return(0,b.jsxs)("div",{className:(0,j.cn)("space-y-6",i),children:[(0,b.jsx)(l,{currentHole:r+1,totalHoles:a,totalStrokes:q,totalPar:p}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("h3",{className:"font-semibold text-gray-900 text-sm uppercase",children:"Scorecard"}),(0,b.jsx)("div",{className:"grid grid-cols-2 gap-2 sm:grid-cols-3 md:grid-cols-4",children:o.map((a,d)=>{let e=d+1,f=c[e];return(0,b.jsx)(k,{holeNumber:e,par:a,score:f,onScoreChange:a=>t(e,a),disabled:h},e)})})]}),(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsx)("h3",{className:"font-semibold text-gray-900 text-sm uppercase",children:"Leaderboard"}),(0,b.jsx)("div",{className:"space-y-2",children:s.length>0?s.map((c,d)=>(0,b.jsxs)(g.Card,{variant:"outlined",className:(0,j.cn)("p-3 flex items-center justify-between","tap-target",0===d&&"border-2 border-fairway-400 bg-fairway-50"),children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 flex-1",children:[(0,b.jsx)("div",{className:"text-center",children:(0,b.jsx)("div",{className:"w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center",children:(0,b.jsx)("span",{className:"text-xs font-bold text-gray-600",children:d+1})})}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("p",{className:"font-medium text-gray-900 text-sm",children:c.name}),(0,b.jsxs)("p",{className:"text-xs text-gray-500",children:[c.entered," holes entered"]})]})]}),(0,b.jsx)("div",{className:"flex items-center gap-4",children:(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsx)("p",{className:"text-lg font-bold text-gray-900",children:c.total}),(0,b.jsx)("p",{className:(0,j.cn)("text-xs font-semibold",c.entered===a&&c.toPar<0?"text-fairway-600":c.entered===a&&c.toPar>0?"text-red-600":"text-gray-600"),children:c.entered===a?0===c.toPar?"E":c.toPar>0?`+${c.toPar}`:c.toPar:"—"})]})})]},c.userId)):(0,b.jsx)(g.Card,{variant:"outlined",className:"p-4 text-center",children:(0,b.jsx)("p",{className:"text-gray-500 text-sm",children:"No scores entered yet"})})})]})]})}a.i(1380);var p=a.i(90925),q=a.i(32636),r=a.i(76780);a.i(69387);var s=a.i(60574),t=a.i(78367),u=a.i(20237);async function v(a,b,c,d){let e=`${b}_${c.holeNumber}`;try{return await (0,s.runTransaction)(u.db,async f=>{let g=(0,t.scoreDoc)(a,e),h=await f.get(g),i=new Date;if(h.exists()){let a=h.data();if(void 0!==d&&a.version!==d)throw Error(`Version mismatch: expected ${d}, got ${a.version}`);let b={...a,strokes:c.strokes,putts:c.putts??a.putts,fairwayHit:c.fairwayHit??a.fairwayHit,greenInRegulation:c.greenInRegulation??a.greenInRegulation,enteredBy:c.enteredBy,updatedAt:i,version:a.version+1,syncedAt:i},e={strokes:b.strokes,putts:b.putts,fairwayHit:b.fairwayHit,greenInRegulation:b.greenInRegulation,enteredBy:b.enteredBy,updatedAt:b.updatedAt,version:b.version,syncedAt:b.syncedAt};return f.update(g,e),b}{let a={id:e,participantId:b,holeNumber:c.holeNumber,strokes:c.strokes,putts:c.putts??null,fairwayHit:c.fairwayHit??null,greenInRegulation:c.greenInRegulation??null,enteredBy:c.enteredBy,createdAt:i,updatedAt:i,version:1,deviceId:c.deviceId,syncedAt:i};return f.set(g,a),a}})}catch(a){throw console.error("Error creating/updating score:",a),a}}var w=a.i(15706);function x({params:a}){let j=a.id,{user:k}=(0,q.useAuth)(),{match:l,loading:m}=(0,r.useMatch)(j),{scores:n,loading:u}=function(a){let[b,d]=(0,c.useState)([]),[e,f]=(0,c.useState)(!0),[g,h]=(0,c.useState)(null);return(0,c.useEffect)(()=>{if(a)try{let b=(0,s.onSnapshot)((0,t.scoresCollection)(a),a=>{let b=a.docs.map(a=>a.data()).sort((a,b)=>a.participantId!==b.participantId?a.participantId.localeCompare(b.participantId):a.holeNumber-b.holeNumber);d(b),h(null),f(!1)},a=>{console.error("Error subscribing to scores:",a),h(a instanceof Error?a:Error("Unknown error")),f(!1)});return()=>b()}catch{}},[a]),{scores:b,loading:e,error:g}}(j),{scores:x}=function(a,b){let[d,e]=(0,c.useState)([]),[f,g]=(0,c.useState)(!0),[h,i]=(0,c.useState)(null);return(0,c.useEffect)(()=>{if(a&&b)try{let c=(0,s.onSnapshot)((0,t.scoresCollection)(a),a=>{let c=a.docs.map(a=>a.data()).filter(a=>a.participantId===b).sort((a,b)=>a.holeNumber-b.holeNumber);e(c),i(null),g(!1)},a=>{console.error("Error subscribing to participant scores:",a),i(a instanceof Error?a:Error("Unknown error")),g(!1)});return()=>c()}catch{}},[a,b]),{scores:d,loading:f,error:h}}(j,k?.id||null),[y,z]=(0,c.useState)(!1),[A,B]=(0,c.useState)(null),[C,D]=(0,c.useState)(!1);if(m)return(0,b.jsx)(p.ProtectedRoute,{children:(0,b.jsxs)(e.Screen,{children:[(0,b.jsx)(f.Header,{title:"Scorecard"}),(0,b.jsx)("div",{className:"p-4 flex items-center justify-center h-96",children:(0,b.jsxs)("div",{className:"text-center space-y-2",children:[(0,b.jsx)("div",{className:"animate-spin text-4xl",children:"⛳"}),(0,b.jsx)("p",{className:"text-gray-500",children:"Loading match..."})]})})]})});if(!l||!k)return(0,b.jsx)(p.ProtectedRoute,{children:(0,b.jsxs)(e.Screen,{children:[(0,b.jsx)(f.Header,{title:"Scorecard"}),(0,b.jsx)("div",{className:"p-4",children:(0,b.jsx)(g.Card,{variant:"outlined",className:"bg-red-50 border-red-200",children:(0,b.jsx)("p",{className:"text-red-700 text-sm",children:"Match not found or not authenticated"})})})]})});let E={};x.forEach(a=>{E[a.holeNumber]=a.strokes});let F={};l.participantIds.forEach(a=>{F[a]={}}),n.forEach(a=>{F[a.participantId]||(F[a.participantId]={}),F[a.participantId][a.holeNumber]=a.strokes});let G=async(a,b)=>{if(k){z(!0),B(null);try{void 0!==b&&await v(j,k.id,{holeNumber:a,strokes:b,enteredBy:k.id,deviceId:"web"}),E[a]=b}catch(a){console.error("Failed to save score:",a),B(a instanceof Error?a.message:"Failed to save score")}finally{z(!1)}}},H=async()=>{z(!0),B(null);try{await (0,w.updateMatchStatus)(j,"completed"),D(!1)}catch(a){console.error("Failed to complete match:",a),B(a instanceof Error?a.message:"Failed to complete match")}finally{z(!1)}},I=Object.values(E).filter(a=>void 0!==a).length===l.holes;return(0,b.jsx)(p.ProtectedRoute,{children:(0,b.jsxs)(e.Screen,{padBottom:!0,children:[(0,b.jsx)(f.Header,{title:l.courseName,subtitle:"Enter Scores"}),(0,b.jsxs)("div",{className:"p-4 pb-24 space-y-6",children:[A&&(0,b.jsx)(g.Card,{variant:"outlined",className:"bg-red-50 border-red-200 p-4",children:(0,b.jsx)("p",{className:"text-red-700 text-sm",children:A})}),u?(0,b.jsxs)("div",{className:"text-center py-8",children:[(0,b.jsx)("div",{className:"animate-spin text-4xl mb-2",children:"⛳"}),(0,b.jsx)("p",{className:"text-gray-500",children:"Loading scores..."})]}):(0,b.jsx)(o,{totalHoles:l.holes,currentUserScores:E,allParticipantScores:F,participantNames:l.participantIds.reduce((a,b)=>(a[b]=k.id===b?k.displayName:`Player ${b.slice(0,6)}`,a),{}),onScoreChange:G,loading:y}),(0,b.jsxs)("div",{className:"space-y-3",children:[I&&"active"===l.status&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(h.Button,{onClick:()=>D(!0),loading:y,disabled:y,fullWidth:!0,children:"Complete Round"}),(0,b.jsx)(d.default,{href:`/match/${j}`,className:"block",children:(0,b.jsx)(h.Button,{variant:"secondary",fullWidth:!0,children:"Back to Match"})})]}),"completed"===l.status&&(0,b.jsx)(d.default,{href:`/match/${j}/results`,className:"block",children:(0,b.jsx)(h.Button,{fullWidth:!0,children:"View Results"})}),!I&&(0,b.jsx)(d.default,{href:`/match/${j}`,className:"block",children:(0,b.jsx)(h.Button,{variant:"secondary",fullWidth:!0,children:"Back to Match"})})]})]}),(0,b.jsx)(i.Modal,{isOpen:C,onClose:()=>D(!1),title:"Complete Round?",size:"md",children:(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("p",{className:"text-gray-600 text-sm",children:"Are you sure you want to complete this round? You can still view and modify scores afterward."}),(0,b.jsxs)("div",{className:"bg-gray-50 p-3 rounded-lg space-y-2",children:[(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsx)("span",{className:"text-gray-600",children:"Course"}),(0,b.jsx)("span",{className:"font-semibold text-gray-900",children:l.courseName})]}),(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsx)("span",{className:"text-gray-600",children:"Holes"}),(0,b.jsx)("span",{className:"font-semibold text-gray-900",children:l.holes})]}),(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsx)("span",{className:"text-gray-600",children:"Players"}),(0,b.jsx)("span",{className:"font-semibold text-gray-900",children:l.participantIds.length})]})]}),(0,b.jsxs)("div",{className:"flex gap-3 pt-2",children:[(0,b.jsx)(h.Button,{variant:"secondary",onClick:()=>D(!1),disabled:y,fullWidth:!0,children:"Cancel"}),(0,b.jsx)(h.Button,{onClick:H,loading:y,disabled:y,fullWidth:!0,children:"Complete"})]})]})})]})})}a.s(["default",()=>x],39380)}];

//# sourceMappingURL=src_app_match_%5Bid%5D_scorecard_page_tsx_76a7ff06._.js.map