module.exports=[24361,(a,b,c)=>{b.exports=a.x("util",()=>require("util"))},14747,(a,b,c)=>{b.exports=a.x("path",()=>require("path"))},32636,78367,56974,a=>{"use strict";let b;var c=a.i(72131);a.i(30485);var d=a.i(31052),e=a.i(20237);a.i(69387);var f=a.i(60574);let g={toFirestore:a=>({...a,createdAt:f.Timestamp.fromDate(a.createdAt),updatedAt:f.Timestamp.fromDate(a.updatedAt),lastActiveAt:f.Timestamp.fromDate(a.lastActiveAt)}),fromFirestore:a=>{let b=a.data();return{...b,id:a.id,createdAt:b.createdAt.toDate(),updatedAt:b.updatedAt.toDate(),lastActiveAt:b.lastActiveAt.toDate()}}},h={toFirestore:a=>({...a,createdAt:f.Timestamp.fromDate(a.createdAt),updatedAt:f.Timestamp.fromDate(a.updatedAt),startedAt:a.startedAt?f.Timestamp.fromDate(a.startedAt):null,completedAt:a.completedAt?f.Timestamp.fromDate(a.completedAt):null,teeTime:f.Timestamp.fromDate(a.teeTime)}),fromFirestore:a=>{let b=a.data();return{...b,id:a.id,createdAt:b.createdAt.toDate(),updatedAt:b.updatedAt.toDate(),startedAt:b.startedAt?.toDate()??null,completedAt:b.completedAt?.toDate()??null,teeTime:b.teeTime.toDate()}}},i={toFirestore:a=>({...a,invitedAt:f.Timestamp.fromDate(a.invitedAt),confirmedAt:a.confirmedAt?f.Timestamp.fromDate(a.confirmedAt):null}),fromFirestore:a=>{let b=a.data();return{...b,id:a.id,invitedAt:b.invitedAt.toDate(),confirmedAt:b.confirmedAt?.toDate()??null}}},j={toFirestore:a=>({...a,createdAt:f.Timestamp.fromDate(a.createdAt),updatedAt:f.Timestamp.fromDate(a.updatedAt),syncedAt:a.syncedAt?f.Timestamp.fromDate(a.syncedAt):null}),fromFirestore:a=>{let b=a.data();return{...b,id:a.id,createdAt:b.createdAt.toDate(),updatedAt:b.updatedAt.toDate(),syncedAt:b.syncedAt?.toDate()??null}}},k={toFirestore:a=>({...a,createdAt:f.Timestamp.fromDate(a.createdAt)}),fromFirestore:a=>{let b=a.data();return{...b,id:a.id,createdAt:b.createdAt.toDate()}}};function l(){return b||(b=(0,f.getFirestore)()),b}let m=a=>(0,f.doc)((0,f.collection)(l(),"users"),a).withConverter(g);async function n(a){try{let b=await (0,f.getDoc)(m(a));return b.exists()?b.data():null}catch(a){throw console.error("Error fetching user:",a),a}}async function o(a,b){let c=new Date,d={id:a,displayName:b.displayName,email:b.email,avatarUrl:null,handicapIndex:null,homeClub:null,defaultTeeBox:"blue",notificationsEnabled:!0,createdAt:c,updatedAt:c,lastActiveAt:c};try{return await (0,f.setDoc)(m(a),d),d}catch(a){throw console.error("Error creating user:",a),a}}async function p(a,b){try{await (0,f.updateDoc)(m(a),{...b,updatedAt:new Date})}catch(a){throw console.error("Error updating user:",a),a}}async function q(a){try{await (0,f.updateDoc)(m(a),{lastActiveAt:new Date})}catch(a){throw console.error("Error updating user activity:",a),a}}function r(){let[a,b]=(0,c.useState)(null),[f,g]=(0,c.useState)(null),[h,i]=(0,c.useState)(!0),[j,k]=(0,c.useState)(null);return(0,c.useEffect)(()=>{let a=(0,d.onAuthStateChanged)(e.auth,async a=>{try{if(b(a),a){let b=await n(a.uid);if(b)await q(a.uid);else{let c=a.displayName||a.email||"User",d=a.email||"";b=await o(a.uid,{displayName:c,email:d})}g(b),k(null)}else g(null),k(null);i(!1)}catch(a){k(a instanceof Error?a:Error("Unknown auth error")),i(!1)}});return()=>a()},[]),{firebaseUser:a,user:f,loading:h,error:j}}a.s(["betDoc",0,(a,b)=>(0,f.doc)((0,f.collection)(l(),`matches/${a}/bets`),b).withConverter(k),"matchDoc",0,a=>(0,f.doc)((0,f.collection)(l(),"matches"),a).withConverter(h),"matchesCollection",0,()=>(0,f.collection)(l(),"matches").withConverter(h),"participantsCollection",0,a=>(0,f.collection)(l(),`matches/${a}/participants`).withConverter(i),"scoreDoc",0,(a,b)=>(0,f.doc)((0,f.collection)(l(),`matches/${a}/scores`),b).withConverter(j),"scoresCollection",0,a=>(0,f.collection)(l(),`matches/${a}/scores`).withConverter(j),"userDoc",0,m],78367),a.s(["createUser",()=>o,"getUser",()=>n,"updateUser",()=>p,"updateUserActivity",()=>q],56974),a.s(["useAuth",()=>r],32636)},1380,90925,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(32636);a.i(45600);var f=a.i(30400);function g({children:a}){let{user:g,loading:h}=(0,e.useAuth)(),i=(0,d.useRouter)();return((0,c.useEffect)(()=>{h||g||i.push("/login")},[g,h,i]),h)?(0,b.jsx)(f.Screen,{className:"flex items-center justify-center",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"animate-spin text-4xl mb-4",children:"â›³"}),(0,b.jsx)("p",{className:"text-gray-500",children:"Loading..."})]})}):g?(0,b.jsx)(b.Fragment,{children:a}):null}a.s(["ProtectedRoute",()=>g],90925),a.s([],1380)},73783,a=>{"use strict";var b=a.i(72131);a.i(69387);var c=a.i(60574);function d(a){let b=new Map;return a.forEach(a=>{b.has(a.fromUserId)||b.set(a.fromUserId,0),b.has(a.toUserId)||b.set(a.toUserId,0)}),a.forEach(a=>{let c=b.get(a.fromUserId)||0,d=b.get(a.toUserId)||0;b.set(a.fromUserId,c-a.amount),b.set(a.toUserId,d+a.amount)}),b}function e(a){return d(a.filter(a=>!a.settled))}function f(a){return Array.from(a.entries()).filter(([,a])=>a<0).map(([a,b])=>({userId:a,amount:Math.abs(b)})).sort((a,b)=>b.amount-a.amount)}function g(a){return Array.from(a.entries()).filter(([,a])=>a>0).map(([a,b])=>({userId:a,amount:b})).sort((a,b)=>b.amount-a.amount)}let h=(0,c.getFirestore)();function i(a){let[i,j]=(0,b.useState)([]),[k,l]=(0,b.useState)(!0),[m,n]=(0,b.useState)(null);(0,b.useEffect)(()=>{if(!a)return;let b=null,d=null;try{let e=(0,c.query)((0,c.collectionGroup)(h,"ledger"),(0,c.where)("fromUserId","==",a)),f=(0,c.query)((0,c.collectionGroup)(h,"ledger"),(0,c.where)("toUserId","==",a));return b=(0,c.onSnapshot)(e,b=>{let c=b.docs.map(a=>a.data());j(b=>{let d=b.filter(b=>b.toUserId===a);return[...c,...d]}),n(null),l(!1)},a=>{console.error("Error subscribing to ledger (from):",a),n(a instanceof Error?a:Error("Unknown error")),l(!1)}),d=(0,c.onSnapshot)(f,b=>{let c=b.docs.map(a=>a.data());j(b=>[...b.filter(b=>b.fromUserId===a),...c]),n(null),l(!1)},a=>{console.error("Error subscribing to ledger (to):",a),n(a instanceof Error?a:Error("Unknown error")),l(!1)}),()=>{b?.(),d?.()}}catch{}},[a]);let o=d(i),p=e(i),q=f(o),r=g(o);return{entries:i,balances:o,unsettledBalances:p,debtors:q,creditors:r,loading:k,error:m}}function j(a){let[i,j]=(0,b.useState)([]),[k,l]=(0,b.useState)(!0),[m,n]=(0,b.useState)(null);(0,b.useEffect)(()=>{if(a)try{let b=(0,c.onSnapshot)((0,c.query)((0,c.collectionGroup)(h,"ledger")),b=>{let c=b.docs.filter(b=>b.ref.parent.parent?.id===a).map(a=>a.data());j(c),n(null),l(!1)},a=>{console.error("Error subscribing to match ledger:",a),n(a instanceof Error?a:Error("Unknown error")),l(!1)});return()=>b()}catch{}},[a]);let o=d(i),p=e(i),q=f(o),r=g(o);return{entries:i,balances:o,unsettledBalances:p,debtors:q,creditors:r,loading:k,error:m}}a.s(["useLedger",()=>i,"useMatchLedger",()=>j],73783)},80758,a=>{"use strict";var b=a.i(87924),c=a.i(72131);a.i(45600);var d=a.i(30400),e=a.i(43218);a.i(11909);var f=a.i(62067),g=a.i(96438),h=a.i(79530);function i({name:a,amount:c,onSettle:d,isSettling:e=!1,className:g}){let i=c>0,j=Math.abs(c);return(0,b.jsxs)(f.Card,{variant:"outlined",className:(0,h.cn)("p-4",g),children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("h3",{className:"font-semibold text-gray-900",children:a}),(0,b.jsx)("p",{className:(0,h.cn)("text-sm mt-1 font-medium",i?"text-fairway-600":"text-red-600"),children:i?"âœ“ Owes you":"â€¢ You owe"})]}),(0,b.jsx)("div",{className:"text-right",children:(0,b.jsxs)("p",{className:(0,h.cn)("text-2xl font-bold",i?"text-fairway-600":"text-red-600"),children:["$",j.toFixed(2)]})})]}),d&&(0,b.jsx)("button",{onClick:d,disabled:e,className:(0,h.cn)("w-full mt-4 px-3 py-2 rounded-lg text-sm font-medium transition-colors",e?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-gray-100 hover:bg-gray-200 text-gray-900"),"aria-label":`Mark ${a} as settled`,children:e?"Marking...":"Mark Settled"})]})}function j({balances:a,loading:d=!1,className:e}){let[f,g]=(0,c.useState)(null),j=async(a,b)=>{if(b){g(a);try{await b(a)}catch(a){console.error("Error settling balance:",a)}finally{g(null)}}},k=[...a].sort((a,b)=>{let c=+(a.amount>0),d=+(b.amount>0);return c!==d?d-c:Math.abs(b.amount)-Math.abs(a.amount)});return 0===a.length?(0,b.jsxs)("div",{className:(0,h.cn)("text-center py-12",e),children:[(0,b.jsx)("p",{className:"text-3xl mb-2",children:"âœ…"}),(0,b.jsx)("p",{className:"text-gray-600 font-medium",children:"All settled up!"}),(0,b.jsx)("p",{className:"text-gray-500 text-sm mt-1",children:"No pending settlements"})]}):(0,b.jsxs)("div",{className:(0,h.cn)("space-y-3",e),children:[d&&(0,b.jsxs)("div",{className:"text-center py-8",children:[(0,b.jsx)("div",{className:"animate-spin text-4xl mb-2",children:"â›³"}),(0,b.jsx)("p",{className:"text-gray-500 text-sm",children:"Loading settlements..."})]}),!d&&k.map(a=>(0,b.jsx)(i,{name:a.name,amount:a.amount,onSettle:a.canSettle&&a.onSettle?()=>j(a.userId,a.onSettle):void 0,isSettling:f===a.userId},a.userId))]})}a.i(1380);var k=a.i(90925),l=a.i(32636),m=a.i(73783);function n(){let{firebaseUser:a}=(0,l.useAuth)(),h=a?.uid||null,{entries:i,balances:n,loading:o,error:p}=(0,m.useLedger)(h),[q,r]=(0,c.useState)(null),s=Array.from(n.entries()).map(([a,b])=>({userId:a,name:`Player ${a.slice(0,6)}`,amount:b,canSettle:!0,onSettle:async()=>{try{for(let b of(r(null),i.filter(b=>!b.settled&&(b.fromUserId===h&&b.toUserId===a||b.fromUserId===a&&b.toUserId===h))))console.log("Settling entry:",b.id)}catch(a){console.error("Error settling:",a),r(a instanceof Error?a.message:"Failed to settle")}}}));return(0,b.jsx)(k.ProtectedRoute,{children:(0,b.jsxs)(d.Screen,{padBottom:!0,children:[(0,b.jsx)(e.Header,{title:"Ledger",subtitle:"Your Balances"}),(0,b.jsxs)("div",{className:"p-4 pb-24 space-y-6",children:[(p||q)&&(0,b.jsx)(f.Card,{variant:"outlined",className:"bg-red-50 border-red-200 p-4",children:(0,b.jsx)("p",{className:"text-red-700 text-sm",children:p?.message||q})}),!o&&(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,b.jsxs)(f.Card,{variant:"elevated",className:"p-4",children:[(0,b.jsx)("p",{className:"text-gray-500 text-sm mb-1",children:"You're Owed"}),(0,b.jsxs)("p",{className:"text-2xl font-bold text-fairway-600",children:["$",Array.from(n.values()).filter(a=>a>0).reduce((a,b)=>a+b,0).toFixed(2)]})]}),(0,b.jsxs)(f.Card,{variant:"elevated",className:"p-4",children:[(0,b.jsx)("p",{className:"text-gray-500 text-sm mb-1",children:"You Owe"}),(0,b.jsxs)("p",{className:"text-2xl font-bold text-red-600",children:["$",Math.abs(Array.from(n.values()).filter(a=>a<0).reduce((a,b)=>a+b,0)).toFixed(2)]})]})]}),o&&(0,b.jsxs)("div",{className:"text-center py-12",children:[(0,b.jsx)("div",{className:"animate-spin text-4xl mb-2",children:"â›³"}),(0,b.jsx)("p",{className:"text-gray-500",children:"Loading ledger..."})]}),!o&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(j,{balances:s,loading:o}),(0,b.jsx)(f.Card,{variant:"outlined",className:"bg-blue-50 border-blue-200 p-4",children:(0,b.jsxs)("p",{className:"text-blue-900 text-sm",children:["ðŸ’¡ ",(0,b.jsx)("span",{className:"font-medium",children:"Settlement Tips:"}),(0,b.jsx)("br",{}),"Settle up offline via Venmo, Zelle, or cash. Mark as settled here when complete."]})}),s.length>0&&(0,b.jsx)(g.Button,{variant:"secondary",fullWidth:!0,children:"View Settlement History"})]}),!o&&0===s.length&&(0,b.jsxs)("div",{className:"text-center py-12",children:[(0,b.jsx)("p",{className:"text-3xl mb-2",children:"âœ…"}),(0,b.jsx)("p",{className:"text-gray-600 font-medium",children:"All settled up!"}),(0,b.jsx)("p",{className:"text-gray-500 text-sm mt-1",children:"No pending balances"})]})]})]})})}a.s(["default",()=>n],80758)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__97e31516._.js.map